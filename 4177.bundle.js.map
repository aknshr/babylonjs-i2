{"version":3,"file":"4177.bundle.js","mappings":"iNAcA,MAAMA,EAAO,6BAqBN,MAAMC,EA0BT,WAAAC,CAAYC,GAtBI,KAAAC,KAAOJ,EAehB,KAAAK,+BAAgC,EAQnCC,KAAKC,QAAUJ,EACfG,KAAKE,QAAU,IAAaC,kBAAoBH,KAAKC,QAAQG,gBAAgBV,EACjF,CAGO,OAAAW,UACIL,KAAKM,aACXN,KAAKC,QAAkB,IAC5B,CAMO,oBAAAM,CAAqBC,EAAiBC,EAA2BC,GACpE,OAAO,KAAWC,mBAAuDH,EAASC,EAAWT,KAAKF,MAAMc,MAAOC,EAAkBC,KAC7H,GAAsBC,MAAlBN,EAAUO,MACa,IAAnBP,EAAUO,MAA2D,IAAnBP,EAAUO,KAC5D,MAAM,IAAIC,MAAM,GAAGT,uBAA6BC,EAAUO,QAIlE,MAAME,EAAyC,CAAC,EAC1CC,EAA0C,CAAC,EAC3CC,EAAgB,CAACtB,EAAcuB,KACjC,MAAMC,EAAWR,EAAUI,WAAWpB,GACtC,GAAgBiB,MAAZO,IAIJZ,EAAYa,WAAab,EAAYa,YAAc,IACL,IAA1Cb,EAAYa,WAAWC,QAAQH,IAC/BX,EAAYa,WAAWE,KAAKJ,GAGhCH,EAAWG,GAAQC,EAEftB,KAAKD,+BAA+B,CACpC,MAAM2B,EAAW,KAAUC,OAAO3B,KAAKC,QAAQ2B,KAAKC,UAAWpB,EAAUS,WAAWpB,IAChF4B,IACAP,EAAWE,GAAQK,EAASP,aAAc,EAElD,GAGJC,EAAc,WAAY,IAAaU,cACvCV,EAAc,SAAU,IAAaW,YACrCX,EAAc,UAAW,IAAaY,aACtCZ,EAAc,aAAc,IAAaa,QACzCb,EAAc,aAAc,IAAac,SACzCd,EAAc,aAAc,IAAae,SACzCf,EAAc,aAAc,IAAagB,SACzChB,EAAc,aAAc,IAAaiB,SACzCjB,EAAc,aAAc,IAAakB,SACzClB,EAAc,WAAY,IAAamB,qBACvCnB,EAAc,YAAa,IAAaoB,qBACxCpB,EAAc,UAAW,IAAaqB,WAEtC,MAAMC,EAAa,KAAUC,IAAI9B,EAAkBb,KAAKC,QAAQ2B,KAAKgB,YAAa9B,EAAU4B,YAe5F,OAdKA,EAAWG,wBACZH,EAAWG,sBAAwB7C,KAAKC,QAAQ6C,oBAAoB,gBAAgBJ,EAAWK,QAASL,GAAYM,MAAKpC,MAAOqC,IAC5H,MAAM3C,EAAeN,KAAKM,cAAgB,IAAa4C,QACjDC,EAAmB,KAAUxB,OAAO3B,KAAKC,QAAQ2B,KAAKC,UAAWpB,EAAUS,WAAqB,UAChGkC,EACDpD,KAAKC,QAAQoD,OAAOC,0BAA6B5C,EAAY6C,WAAYJ,EAA4E,MAAzD,QAAqCA,GACtI,aAAa7C,EACRkD,kCAAkC9C,EAAYZ,KAAME,KAAKC,QAAQwD,aAAcR,EAAM/B,EAAYC,EAAYiC,GAC7GM,OAAOC,IACJ,MAAM,IAAI1C,MAAM,GAAGT,MAAYmD,EAAMC,wBAKxClB,EAAWG,wBAEhC,GAGJ,QAAwBnD,IACxB,QAAsBA,GAAM,GAAOG,GAAW,IAAIF,EAA2BE,I","sources":["webpack://@dev/inspector-v2/../loaders/src/glTF/2.0/Extensions/KHR_draco_mesh_compression.ts?"],"sourcesContent":["/* eslint-disable github/no-then */\r\nimport { DracoDecoder } from \"core/Meshes/Compression/dracoDecoder\";\r\nimport type { Nullable } from \"core/types\";\r\nimport { VertexBuffer } from \"core/Buffers/buffer\";\r\nimport type { Geometry } from \"core/Meshes/geometry\";\r\nimport type { Mesh } from \"core/Meshes/mesh\";\r\n\r\nimport { MeshPrimitiveMode } from \"babylonjs-gltf2interface\";\r\nimport type { IKHRDracoMeshCompression } from \"babylonjs-gltf2interface\";\r\nimport type { IMeshPrimitive, IBufferView } from \"../glTFLoaderInterfaces\";\r\nimport type { IGLTFLoaderExtension } from \"../glTFLoaderExtension\";\r\nimport { GLTFLoader, ArrayItem, LoadBoundingInfoFromPositionAccessor } from \"../glTFLoader\";\r\nimport { registerGLTFExtension, unregisterGLTFExtension } from \"../glTFLoaderExtensionRegistry\";\r\n\r\nconst NAME = \"KHR_draco_mesh_compression\";\r\n\r\ndeclare module \"../../glTFFileLoader\" {\r\n    // eslint-disable-next-line jsdoc/require-jsdoc, @typescript-eslint/naming-convention\r\n    export interface GLTFLoaderExtensionOptions {\r\n        /**\r\n         * Defines options for the KHR_draco_mesh_compression extension.\r\n         */\r\n        // NOTE: Don't use NAME here as it will break the UMD type declarations.\r\n        [\"KHR_draco_mesh_compression\"]: {};\r\n    }\r\n}\r\n\r\ninterface IBufferViewDraco extends IBufferView {\r\n    _dracoBabylonGeometry?: Promise<Geometry>;\r\n}\r\n\r\n/**\r\n * [Specification](https://github.com/KhronosGroup/glTF/blob/main/extensions/2.0/Khronos/KHR_draco_mesh_compression/README.md)\r\n */\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\nexport class KHR_draco_mesh_compression implements IGLTFLoaderExtension {\r\n    /**\r\n     * The name of this extension.\r\n     */\r\n    public readonly name = NAME;\r\n\r\n    /**\r\n     * The draco decoder used to decode vertex data or DracoDecoder.Default if not defined\r\n     */\r\n    public dracoDecoder?: DracoDecoder;\r\n\r\n    /**\r\n     * Defines whether this extension is enabled.\r\n     */\r\n    public enabled: boolean;\r\n\r\n    /**\r\n     * Defines whether to use the normalized flag from the glTF accessor instead of the Draco data. Defaults to true.\r\n     */\r\n    public useNormalizedFlagFromAccessor = true;\r\n\r\n    private _loader: GLTFLoader;\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    constructor(loader: GLTFLoader) {\r\n        this._loader = loader;\r\n        this.enabled = DracoDecoder.DefaultAvailable && this._loader.isExtensionUsed(NAME);\r\n    }\r\n\r\n    /** @internal */\r\n    public dispose(): void {\r\n        delete this.dracoDecoder;\r\n        (this._loader as any) = null;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    // eslint-disable-next-line no-restricted-syntax\r\n    public _loadVertexDataAsync(context: string, primitive: IMeshPrimitive, babylonMesh: Mesh): Nullable<Promise<Geometry>> {\r\n        return GLTFLoader.LoadExtensionAsync<IKHRDracoMeshCompression, Geometry>(context, primitive, this.name, async (extensionContext, extension) => {\r\n            if (primitive.mode != undefined) {\r\n                if (primitive.mode !== MeshPrimitiveMode.TRIANGLES && primitive.mode !== MeshPrimitiveMode.TRIANGLE_STRIP) {\r\n                    throw new Error(`${context}: Unsupported mode ${primitive.mode}`);\r\n                }\r\n            }\r\n\r\n            const attributes: { [kind: string]: number } = {};\r\n            const normalized: { [kind: string]: boolean } = {};\r\n            const loadAttribute = (name: string, kind: string) => {\r\n                const uniqueId = extension.attributes[name];\r\n                if (uniqueId == undefined) {\r\n                    return;\r\n                }\r\n\r\n                babylonMesh._delayInfo = babylonMesh._delayInfo || [];\r\n                if (babylonMesh._delayInfo.indexOf(kind) === -1) {\r\n                    babylonMesh._delayInfo.push(kind);\r\n                }\r\n\r\n                attributes[kind] = uniqueId;\r\n\r\n                if (this.useNormalizedFlagFromAccessor) {\r\n                    const accessor = ArrayItem.TryGet(this._loader.gltf.accessors, primitive.attributes[name]);\r\n                    if (accessor) {\r\n                        normalized[kind] = accessor.normalized || false;\r\n                    }\r\n                }\r\n            };\r\n\r\n            loadAttribute(\"POSITION\", VertexBuffer.PositionKind);\r\n            loadAttribute(\"NORMAL\", VertexBuffer.NormalKind);\r\n            loadAttribute(\"TANGENT\", VertexBuffer.TangentKind);\r\n            loadAttribute(\"TEXCOORD_0\", VertexBuffer.UVKind);\r\n            loadAttribute(\"TEXCOORD_1\", VertexBuffer.UV2Kind);\r\n            loadAttribute(\"TEXCOORD_2\", VertexBuffer.UV3Kind);\r\n            loadAttribute(\"TEXCOORD_3\", VertexBuffer.UV4Kind);\r\n            loadAttribute(\"TEXCOORD_4\", VertexBuffer.UV5Kind);\r\n            loadAttribute(\"TEXCOORD_5\", VertexBuffer.UV6Kind);\r\n            loadAttribute(\"JOINTS_0\", VertexBuffer.MatricesIndicesKind);\r\n            loadAttribute(\"WEIGHTS_0\", VertexBuffer.MatricesWeightsKind);\r\n            loadAttribute(\"COLOR_0\", VertexBuffer.ColorKind);\r\n\r\n            const bufferView = ArrayItem.Get(extensionContext, this._loader.gltf.bufferViews, extension.bufferView) as IBufferViewDraco;\r\n            if (!bufferView._dracoBabylonGeometry) {\r\n                bufferView._dracoBabylonGeometry = this._loader.loadBufferViewAsync(`/bufferViews/${bufferView.index}`, bufferView).then(async (data) => {\r\n                    const dracoDecoder = this.dracoDecoder || DracoDecoder.Default;\r\n                    const positionAccessor = ArrayItem.TryGet(this._loader.gltf.accessors, primitive.attributes[\"POSITION\"]);\r\n                    const babylonBoundingInfo =\r\n                        !this._loader.parent.alwaysComputeBoundingBox && !babylonMesh.skeleton && positionAccessor ? LoadBoundingInfoFromPositionAccessor(positionAccessor) : null;\r\n                    return await dracoDecoder\r\n                        ._decodeMeshToGeometryForGltfAsync(babylonMesh.name, this._loader.babylonScene, data, attributes, normalized, babylonBoundingInfo)\r\n                        .catch((error) => {\r\n                            throw new Error(`${context}: ${error.message}`);\r\n                        });\r\n                });\r\n            }\r\n\r\n            return await bufferView._dracoBabylonGeometry;\r\n        });\r\n    }\r\n}\r\n\r\nunregisterGLTFExtension(NAME);\r\nregisterGLTFExtension(NAME, true, (loader) => new KHR_draco_mesh_compression(loader));\r\n"],"names":["NAME","KHR_draco_mesh_compression","constructor","loader","name","useNormalizedFlagFromAccessor","this","_loader","enabled","DefaultAvailable","isExtensionUsed","dispose","dracoDecoder","_loadVertexDataAsync","context","primitive","babylonMesh","LoadExtensionAsync","async","extensionContext","extension","undefined","mode","Error","attributes","normalized","loadAttribute","kind","uniqueId","_delayInfo","indexOf","push","accessor","TryGet","gltf","accessors","PositionKind","NormalKind","TangentKind","UVKind","UV2Kind","UV3Kind","UV4Kind","UV5Kind","UV6Kind","MatricesIndicesKind","MatricesWeightsKind","ColorKind","bufferView","Get","bufferViews","_dracoBabylonGeometry","loadBufferViewAsync","index","then","data","Default","positionAccessor","babylonBoundingInfo","parent","alwaysComputeBoundingBox","skeleton","_decodeMeshToGeometryForGltfAsync","babylonScene","catch","error","message"],"ignoreList":[],"sourceRoot":""}