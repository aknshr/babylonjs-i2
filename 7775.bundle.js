"use strict";(self.webpackChunk_dev_inspector_v2=self.webpackChunk_dev_inspector_v2||[]).push([[7775],{67775:(e,t,a)=>{a.r(t),a.d(t,{FlowGraphSetDelayBlock:()=>d});var n=a(85858),i=a(41862),l=a(6086),s=a(83031),r=a(72062),o=a(34542);class d extends n.M{constructor(e){super(e),this.cancel=this._registerSignalInput("cancel"),this.duration=this.registerDataInput("duration",i.Es),this.lastDelayIndex=this.registerDataOutput("lastDelayIndex",i.x2,new o.P(-1))}_preparePendingTasks(e){const t=this.duration.getValue(e);if(t<0||isNaN(t)||!isFinite(t))return this._reportError(e,"Invalid duration in SetDelay block");if(e._getGlobalContextVariable("activeDelays",0)>=d.MaxParallelDelayCount)return this._reportError(e,"Max parallel delays reached");const a=e._getGlobalContextVariable("lastDelayIndex",-1),n=e._getExecutionVariable(this,"pendingDelays",[]),i=e.configuration.scene,s=new l.Qz({timeout:1e3*t,contextObservable:i.onBeforeRenderObservable,onEnded:()=>this._onEnded(s,e)});s.start();const r=a+1;this.lastDelayIndex.setValue(new o.P(r),e),e._setGlobalContextVariable("lastDelayIndex",r),n[r]=s,e._setExecutionVariable(this,"pendingDelays",n),this._updateGlobalTimers(e)}_cancelPendingTasks(e){const t=e._getExecutionVariable(this,"pendingDelays",[]);for(const e of t)e?.dispose();e._deleteExecutionVariable(this,"pendingDelays"),this.lastDelayIndex.setValue(new o.P(-1),e),this._updateGlobalTimers(e)}_execute(e,t){t!==this.cancel?(this._preparePendingTasks(e),this.out._activateSignal(e)):this._cancelPendingTasks(e)}getClassName(){return"FlowGraphSetDelayBlock"}_onEnded(e,t){const a=t._getExecutionVariable(this,"pendingDelays",[]),n=a.indexOf(e);-1!==n?a.splice(n,1):s.V.Warn("FlowGraphTimerBlock: Timer ended but was not found in the running timers list"),t._removePendingBlock(this),this.done._activateSignal(t),this._updateGlobalTimers(t)}_updateGlobalTimers(e){const t=e._getExecutionVariable(this,"pendingDelays",[]),a=e._getGlobalContextVariable("pendingDelays",[]);for(let e=0;e<t.length;e++){if(!t[e])continue;const n=t[e];a[e]&&a[e]!==n?s.V.Warn("FlowGraphTimerBlock: Timer ended but was not found in the running timers list"):a[e]=n}e._setGlobalContextVariable("pendingDelays",a)}}d.MaxParallelDelayCount=100,(0,r.Y5)("FlowGraphSetDelayBlock",d)}}]);
//# sourceMappingURL=7775.bundle.js.map