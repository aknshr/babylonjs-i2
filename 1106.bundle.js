"use strict";(self.webpackChunk_dev_inspector_v2=self.webpackChunk_dev_inspector_v2||[]).push([[1106],{8380:(e,t,n)=>{function a(e,t){return!(!e.parent||e.parent!==t&&!a(e.parent,t))}function o(e){if(e.getClassName)return e.getClassName()}function i(e,t){return e===t&&("Vector2"===e||"Vector3"===e||"Vector4"===e||"Quaternion"===e)}function s(e,t){return e===t&&("Matrix"===e||"Matrix2D"===e||"Matrix3D"===e)}function r(e,t){return"FlowGraphInteger"===e&&"FlowGraphInteger"===t}function l(e,t){const n="number"==typeof e||"number"==typeof e?.value;return n&&!t?!isNaN(c(e)):n}function c(e){return"number"==typeof e?e:e.value}n.d(t,{$w:()=>c,Ah:()=>a,An:()=>r,I$:()=>o,VW:()=>s,a2:()=>i,kf:()=>l})},21142:(e,t,n)=>{n.d(t,{u:()=>r});var a=n(63683),o=n(81661),i=n(72062);class s extends o.X{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(e){super.connectTo(e),this._connectedPoint.sort(((e,t)=>t.priority-e.priority))}_activateSignal(e){if(e.logger?.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,payload:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)e._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(e,this),e._increaseExecutionId();else for(const t of this._connectedPoint)t._activateSignal(e)}}(0,i.Y5)("FlowGraphSignalConnection",s);class r extends a.e{constructor(e){super(e),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(e){const t=new s(e,0,this);return this.signalInputs.push(t),t}_registerSignalOutput(e){const t=new s(e,1,this);return this.signalOutputs.push(t),t}_unregisterSignalInput(e){const t=this.signalInputs.findIndex((t=>t.name===e));-1!==t&&(this.signalInputs[t].dispose(),this.signalInputs.splice(t,1))}_unregisterSignalOutput(e){const t=this.signalOutputs.findIndex((t=>t.name===e));-1!==t&&(this.signalOutputs[t].dispose(),this.signalOutputs.splice(t,1))}_reportError(e,t){this.error.payload="string"==typeof t?new Error(t):t,this.error._activateSignal(e)}getSignalInput(e){return this.signalInputs.find((t=>t.name===e))}getSignalOutput(e){return this.signalOutputs.find((t=>t.name===e))}serialize(e={}){super.serialize(e),e.signalInputs=[],e.signalOutputs=[];for(const t of this.signalInputs){const n={};t.serialize(n),e.signalInputs.push(n)}for(const t of this.signalOutputs){const n={};t.serialize(n),e.signalOutputs.push(n)}}deserialize(e){for(let t=0;t<e.signalInputs.length;t++){const n=this.getSignalInput(e.signalInputs[t].name);if(!n)throw new Error("Could not find signal input with name "+e.signalInputs[t].name+" in block "+e.className);n.deserialize(e.signalInputs[t])}for(let t=0;t<e.signalOutputs.length;t++){const n=this.getSignalOutput(e.signalOutputs[t].name);if(!n)throw new Error("Could not find signal output with name "+e.signalOutputs[t].name+" in block "+e.className);n.deserialize(e.signalOutputs[t])}}getClassName(){return"FlowGraphExecutionBlock"}}},31106:(e,t,n)=>{n.d(t,{KHR_interactivity:()=>k});var a=n(92137);const o={};var i=n(83612),s=n(21142),r=n(50697);function l(e,t){for(const n of e)for(const e of n.dataOutputs)if(e.uniqueId===t)return e;throw new Error("Could not find data out connection with unique id "+t)}function c(e,t){for(const n of e)if(n instanceof s.u)for(const e of n.signalInputs)if(e.uniqueId===t)return e;throw new Error("Could not find signal in connection with unique id "+t)}function h(e,t,n){const a=t.graph.createContext();e.enableLogging&&(a.enableLogging=!0),a.treatDataAsRightHanded=n||!1;const o=t.valueParseFunction??r.wk;a.uniqueId=e.uniqueId;const i=a.getScene();if(e._assetsContext){const t=e._assetsContext,n={meshes:t.meshes?.map((e=>i.getMeshById(e))),lights:t.lights?.map((e=>i.getLightByName(e))),cameras:t.cameras?.map((e=>i.getCameraByName(e))),materials:t.materials?.map((e=>i.getMaterialById(e))),textures:t.textures?.map((e=>i.getTextureByName(e))),animations:t.animations?.map((e=>i.animations.find((t=>t.name===e)))),skeletons:t.skeletons?.map((e=>i.getSkeletonByName(e))),particleSystems:t.particleSystems?.map((e=>i.getParticleSystemById(e))),animationGroups:t.animationGroups?.map((e=>i.getAnimationGroupByName(e))),transformNodes:t.transformNodes?.map((e=>i.getTransformNodeById(e))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],sounds:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};a.assetsContext=n}for(const t in e._userVariables){const n=o(t,e._userVariables,a.assetsContext,i);a.userVariables[t]=n}for(const t in e._connectionValues){const n=o(t,e._connectionValues,a.assetsContext,i);a._setConnectionValueByKey(t,n)}return a}function u(e,t,n){const a={},o=t.valueParseFunction??r.wk;if(e.config)for(const n in e.config)a[n]=o(n,e.config,t.assetsContainer||t.scene,t.scene);if((0,r.$Q)(e.className)){if(!t.pathConverter)throw new Error("Path converter is required for this block");a.pathConverter=t.pathConverter}const i=new n(a);i.uniqueId=e.uniqueId;for(let t=0;t<e.dataInputs.length;t++){const n=i.getDataInput(e.dataInputs[t].name);if(!n)throw new Error("Could not find data input with name "+e.dataInputs[t].name+" in block "+e.className);n.deserialize(e.dataInputs[t])}for(let t=0;t<e.dataOutputs.length;t++){const n=i.getDataOutput(e.dataOutputs[t].name);if(!n)throw new Error("Could not find data output with name "+e.dataOutputs[t].name+" in block "+e.className);n.deserialize(e.dataOutputs[t])}return i.metadata=e.metadata,i.deserialize&&i.deserialize(e),i}n(41862);var p=n(96734),d=n(98817),w=n(4760),g=n(83031),f=n(14858);const b={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"Vector3",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class m{constructor(e,t,n=60){this._interactivityGraph=e,this._gltf=t,this._animationTargetFps=n,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const e of this._interactivityGraph.types)this._types.push(b[e.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const e of this._interactivityGraph.declarations){const t=(0,w.KD)(e);if(!t)throw g.V.Error(["No mapping found for declaration",e]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:t,fullOperationName:e.extension?e.op+":"+e.extension:e.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const e of this._interactivityGraph.variables){const t=this._parseVariable(e);this._staticVariables.push(t)}}_parseVariable(e,t){const n=this._types[e.type];if(!n)throw g.V.Error(["No type found for variable",e]),new Error("Error parsing variables");if(e.value&&e.value.length!==n.length)throw g.V.Error(["Invalid value length for variable",e,n]),new Error("Error parsing variables");const a=e.value||[];if(!a.length)switch(n.flowGraphType){case"boolean":a.push(!1);break;case"FlowGraphInteger":a.push(0);break;case"number":a.push(NaN);break;case"Vector2":a.push(NaN,NaN);break;case"Vector3":a.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":a.fill(NaN,0,4);break;case"Matrix":a.fill(NaN,0,16);break;case"Matrix3D":a.fill(NaN,0,9)}return"number"===n.elementType&&"string"==typeof a[0]&&(a[0]=parseFloat(a[0])),{type:n.flowGraphType,value:t?t(a,this):a}}_parseEvents(){if(this._interactivityGraph.events)for(const e of this._interactivityGraph.events){const t={eventId:e.id||"internalEvent_"+this._internalEventsCounter++};e.values&&(t.eventData=Object.keys(e.values).map((t=>{const n=e.values?.[t];if(!n)throw g.V.Error(["No value found for event key",t]),new Error("Error parsing events");const a=this._types[n.type];if(!a)throw g.V.Error(["No type found for event value",n]),new Error("Error parsing events");const o=void 0!==n.value?this._parseVariable(n):void 0;return{id:t,type:a.flowGraphType,eventData:!0,value:o}}))),this._events.push(t)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const e of this._interactivityGraph.nodes){if("number"!=typeof e.declaration)throw g.V.Error(["No declaration found for node",e]),new Error("Error parsing nodes");const t=this._mappings[e.declaration];if(!t)throw g.V.Error(["No mapping found for node",e]),new Error("Error parsing nodes");if(t.flowGraphMapping.validation){const n=t.flowGraphMapping.validation(e,this._interactivityGraph,this._gltf);if(!n.valid)throw new Error(`Error validating interactivity node ${this._interactivityGraph.declarations?.[e.declaration].op} - ${n.error}`)}const n=[];for(const a of t.flowGraphMapping.blocks){const o=this._getEmptyBlock(a,t.fullOperationName);this._parseNodeConfiguration(e,o,t.flowGraphMapping,a),n.push(o)}this._nodes.push({blocks:n,fullOperationName:t.fullOperationName})}}_getEmptyBlock(e,t){return{uniqueId:(0,f.z)(),className:e,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:t,metadata:{}}}_parseNodeConfiguration(e,t,n,a){const o=e.configuration;if(o)for(const e in o){const i=o[e];if(!i)throw new Error("Error parsing node configuration");const s=n.configuration?.[e];if(s&&s.toBlock?s.toBlock===a:0===n.blocks.indexOf(a)){let n=s?.defaultValue;i?.value&&(n=i.value),s?.isArray||(1!==n.length&&g.V.Warn(`Invalid non-array value length: ${n.length}`),n=n[0]),s?.dataTransformer&&(n=s.dataTransformer(n,this)),void 0!==n&&(t.config[s?.name||e]={value:n})}}}_parseNodeConnections(e){for(let t=0;t<this._nodes.length;t++){const n=this._interactivityGraph.nodes?.[t];if(!n)throw g.V.Error(["No node found for interactivity node",this._nodes[t]]),new Error("Error parsing node connections");const a=this._nodes[t],o=this._mappings[n.declaration];if(!o)throw g.V.Error(["No mapping found for node",n]),new Error("Error parsing node connections");const i=n.flows||{},s=Object.keys(i).sort();for(const e of s){const t=i[e],n=o.flowGraphMapping.outputs?.flows?.[e],s=n?.name||e,r=this._createNewSocketConnection(s,!0);(n&&n.toBlock&&a.blocks.find((e=>e.className===n.toBlock))||a.blocks[0]).signalOutputs.push(r);const l=t.node,c=this._nodes[l];if(!c)throw g.V.Error(["No node found for input node id",l]),new Error("Error parsing node connections");const h=(0,w.X6)(c.fullOperationName);if(!h)throw g.V.Error(["No mapping found for input node",c]),new Error("Error parsing node connections");let u=h.inputs?.flows?.[t.socket||"in"],p=!1;if(!u)for(const e in h.inputs?.flows)e.startsWith("[")&&e.endsWith("]")&&(p=!0,u=h.inputs?.flows?.[e]);const d=u?p?u.name.replace("$1",t.socket||""):u.name:t.socket||"in",f=u&&u.toBlock&&c.blocks.find((e=>e.className===u.toBlock))||c.blocks[0];let b=f.signalInputs.find((e=>e.name===d));b||(b=this._createNewSocketConnection(d),f.signalInputs.push(b)),b.connectedPointIds.push(r.uniqueId),r.connectedPointIds.push(b.uniqueId)}const r=n.values||{},l=Object.keys(r);for(const t of l){const n=r[t];let i=o.flowGraphMapping.inputs?.values?.[t],s=!1;if(!i)for(const e in o.flowGraphMapping.inputs?.values)e.startsWith("[")&&e.endsWith("]")&&(s=!0,i=o.flowGraphMapping.inputs?.values?.[e]);const l=i?s?i.name.replace("$1",t):i.name:t,c=this._createNewSocketConnection(l);if((i&&i.toBlock&&a.blocks.find((e=>e.className===i.toBlock))||a.blocks[0]).dataInputs.push(c),void 0!==n.value){const t=this._parseVariable(n,i&&i.dataTransformer);e._connectionValues[c.uniqueId]=t}else{if(void 0===n.node)throw g.V.Error(["Invalid value for value connection",n]),new Error("Error parsing node connections");{const e=n.node,t=n.socket||"value",a=this._nodes[e];if(!a)throw g.V.Error(["No node found for output socket reference",n]),new Error("Error parsing node connections");const o=(0,w.X6)(a.fullOperationName);if(!o)throw g.V.Error(["No mapping found for output socket reference",n]),new Error("Error parsing node connections");let i=o.outputs?.values?.[t],s=!1;if(!i)for(const e in o.outputs?.values)e.startsWith("[")&&e.endsWith("]")&&(s=!0,i=o.outputs?.values?.[e]);const r=i?s?i.name.replace("$1",t):i?.name:t,l=i&&i.toBlock&&a.blocks.find((e=>e.className===i.toBlock))||a.blocks[0];let h=l.dataOutputs.find((e=>e.name===r));h||(h=this._createNewSocketConnection(r,!0),l.dataOutputs.push(h)),c.connectedPointIds.push(h.uniqueId),h.connectedPointIds.push(c.uniqueId)}}}if(o.flowGraphMapping.interBlockConnectors)for(const e of o.flowGraphMapping.interBlockConnectors){const t=e.input,n=e.output,o=e.isVariable;this._connectFlowGraphNodes(t,n,a.blocks[e.inputBlockIndex],a.blocks[e.outputBlockIndex],o)}if(o.flowGraphMapping.extraProcessor){const t=this._interactivityGraph.declarations?.[n.declaration];if(!t)throw g.V.Error(["No declaration found for extra processor",n]),new Error("Error parsing node connections");a.blocks=o.flowGraphMapping.extraProcessor(n,t,o.flowGraphMapping,this,a.blocks,e,this._gltf)}}}_createNewSocketConnection(e,t){return{uniqueId:(0,f.z)(),name:e,_connectionType:t?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(e,t,n,a,o){const i=o?n.dataInputs:n.signalInputs,s=o?a.dataOutputs:a.signalOutputs,r=i.find((t=>t.name===e))||this._createNewSocketConnection(e),l=s.find((e=>e.name===t))||this._createNewSocketConnection(t,!0);i.find((t=>t.name===e))||i.push(r),s.find((e=>e.name===t))||s.push(l),r.connectedPointIds.push(l.uniqueId),l.connectedPointIds.push(r.uniqueId)}getVariableName(e){return"staticVariable_"+e}serializeToFlowGraph(){const e={uniqueId:(0,f.z)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(e);for(let t=0;t<this._staticVariables.length;t++){const n=this._staticVariables[t];e._userVariables[this.getVariableName(t)]=n}return{rightHanded:!0,allBlocks:this._nodes.reduce(((e,t)=>e.concat(t.blocks)),[]),executionContexts:[e]}}}var y=n(31273);const _="KHR_interactivity";class k{constructor(e){this._loader=e,this.name=_,this.enabled=this._loader.isExtensionUsed(_),this._pathConverter=(0,d.Wt)(this._loader.gltf),e._skipStartAnimationStep=!0;const t=e.babylonScene;t&&function(e){(0,d.oR)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!e.activeCamera)return new y.PT(NaN,NaN,NaN,NaN);const t=y.PT.FromRotationMatrix(e.activeCamera.getWorldMatrix()).normalize();return e.useRightHandedSystem||(t.w*=-1,t.x*=-1),t},type:"Quaternion",getTarget:()=>e.activeCamera}),(0,d.oR)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!e.activeCamera)return new y.Pq(NaN,NaN,NaN);const t=e.activeCamera.getWorldMatrix().getTranslation();return e.useRightHandedSystem||(t.x*=-1),t},type:"Vector3",getTarget:()=>e.activeCamera}),(0,d.oR)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:e=>e._babylonAnimationGroup?.isPlaying??!1,type:"boolean",getTarget:e=>e._babylonAnimationGroup}),(0,d.oR)("/animations/{}/extensions/KHR_interactivity/minTime",{get:e=>(e._babylonAnimationGroup?.from??0)/60,type:"number",getTarget:e=>e._babylonAnimationGroup}),(0,d.oR)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:e=>(e._babylonAnimationGroup?.to??0)/60,type:"number",getTarget:e=>e._babylonAnimationGroup}),(0,d.oR)("/animations/{}/extensions/KHR_interactivity/playhead",{get:e=>(e._babylonAnimationGroup?.getCurrentFrame()??0)/60,type:"number",getTarget:e=>e._babylonAnimationGroup}),(0,d.oR)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:e=>(e._babylonAnimationGroup?.getCurrentFrame()??0)/60,type:"number",getTarget:e=>e._babylonAnimationGroup})}(t)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){if(!this._loader.babylonScene||!this._pathConverter)return;const e=this._loader.babylonScene,t=this._loader.gltf.extensions?.KHR_interactivity;if(!t)return;const p=new a.x({scene:e});p.dispatchEventsSynchronously=!1;const d=t.graphs.map((e=>new m(e,this._loader.gltf,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(d.map((async e=>await async function(e,t){const a=await Promise.all(e.allBlocks.map((async e=>{const t=function(e){switch(e){case"FlowGraphPlayAnimationBlock":return async()=>(await n.e(5621).then(n.bind(n,75621))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await n.e(135).then(n.bind(n,30135))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await n.e(4007).then(n.bind(n,54007))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await n.e(9895).then(n.bind(n,39895))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await n.e(2557).then(n.bind(n,32557))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await n.e(7503).then(n.bind(n,97503))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await n.e(9711).then(n.bind(n,39711))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await n.e(9588).then(n.bind(n,9588))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await n.e(3970).then(n.bind(n,93970))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await n.e(8270).then(n.bind(n,38270))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await n.e(8270).then(n.bind(n,38270))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await n.e(8270).then(n.bind(n,38270))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await n.e(8270).then(n.bind(n,38270))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await n.e(8270).then(n.bind(n,38270))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await n.e(8270).then(n.bind(n,38270))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await n.e(3793).then(n.bind(n,23793))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await n.e(3793).then(n.bind(n,23793))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await n.e(3793).then(n.bind(n,23793))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await n.e(3793).then(n.bind(n,23793))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await n.e(9066).then(n.bind(n,39066))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await n.e(7775).then(n.bind(n,67775))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await n.e(3229).then(n.bind(n,53229))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await n.e(6486).then(n.bind(n,56486))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await n.e(6011).then(n.bind(n,76011))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await n.e(2038).then(n.bind(n,2038))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await n.e(1181).then(n.bind(n,91181))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await n.e(5072).then(n.bind(n,5072))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await n.e(1245).then(n.bind(n,21245))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await n.e(9804).then(n.bind(n,79804))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await n.e(2797).then(n.bind(n,72797))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await n.e(5358).then(n.bind(n,45358))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await n.e(2930).then(n.bind(n,92930))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await n.e(1291).then(n.bind(n,11291))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await n.e(4087).then(n.bind(n,44087))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await n.e(1608).then(n.bind(n,21608))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await n.e(8291).then(n.bind(n,60672))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await n.e(7930).then(n.bind(n,7930))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await n.e(8744).then(n.bind(n,88744))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await n.e(2631).then(n.bind(n,72631))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await n.e(5571).then(n.bind(n,95571))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await n.e(5672).then(n.bind(n,55672))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await n.e(9700).then(n.bind(n,39700))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await n.e(3776).then(n.bind(n,13776))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await n.e(5468).then(n.bind(n,25468))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await n.e(3950).then(n.bind(n,43950))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await n.e(3950).then(n.bind(n,43950))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await n.e(3950).then(n.bind(n,43950))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await n.e(3950).then(n.bind(n,43950))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await n.e(3950).then(n.bind(n,43950))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await n.e(3950).then(n.bind(n,43950))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await n.e(3950).then(n.bind(n,43950))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await n.e(3950).then(n.bind(n,43950))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await n.e(8270).then(n.bind(n,38270))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await n.e(8270).then(n.bind(n,38270))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await n.e(8270).then(n.bind(n,38270))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await n.e(8270).then(n.bind(n,38270))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await n.e(8270).then(n.bind(n,38270))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await n.e(8270).then(n.bind(n,38270))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await n.e(8270).then(n.bind(n,38270))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await n.e(3793).then(n.bind(n,23793))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await n.e(3793).then(n.bind(n,23793))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await n.e(1097).then(n.bind(n,71097))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await n.e(1097).then(n.bind(n,71097))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await n.e(1097).then(n.bind(n,71097))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await n.e(1097).then(n.bind(n,71097))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await n.e(1097).then(n.bind(n,71097))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await n.e(1097).then(n.bind(n,71097))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await n.e(4680).then(n.bind(n,84680))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await n.e(1792).then(n.bind(n,61792))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await n.e(4249).then(n.bind(n,74249))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await n.e(7049).then(n.bind(n,97049))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await n.e(5943).then(n.bind(n,25943))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await n.e(7111).then(n.bind(n,47111))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await n.e(1513).then(n.bind(n,1513))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await n.e(8161).then(n.bind(n,38161))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await n.e(3865).then(n.bind(n,93865))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await n.e(9720).then(n.bind(n,89720))).FlowGraphDataSwitchBlock;default:if(o[e])return o[e];throw new Error(`Unknown block name ${e}`)}}(e.className);return await t()})));return function(e,t,n){const a=t.coordinator.createGraph(),o=[],p=t.valueParseFunction??r.wk;for(let s=0;s<e.allBlocks.length;s++){const r=u(e.allBlocks[s],{scene:t.coordinator.config.scene,pathConverter:t.pathConverter,assetsContainer:t.coordinator.config.scene,valueParseFunction:p},n[s]);o.push(r),r instanceof i.i&&a.addEventBlock(r)}for(const e of o){for(const t of e.dataInputs)for(const e of t.connectedPointIds){const n=l(o,e);t.connectTo(n)}if(e instanceof s.u)for(const t of e.signalOutputs)for(const e of t.connectedPointIds){const n=c(o,e);t.connectTo(n)}}for(const t of e.executionContexts)h(t,{graph:a,valueParseFunction:p},e.rightHanded);return a}(e,t,a)}(e,{coordinator:p,pathConverter:this._pathConverter})))),p.start()}}var G;G=async()=>(await n.e(6609).then(n.bind(n,26609))).FlowGraphGLTFDataProvider,o[`${_}/FlowGraphGLTFDataProvider`]=G,(0,p.Hg)(_),(0,p.Ye)(_,!0,(e=>new k(e)))},50697:(e,t,n)=>{n.d(t,{$Q:()=>u,X5:()=>c,wk:()=>h});var a=n(43291),o=n(31273),i=n(34542),s=n(41862),r=n(23147);function l(e){return"Vector2"===e||"Vector3"===e||"Vector4"===e||"Quaternion"===e||"Color3"===e||"Color4"===e}function c(e,t,n){const a=t?.getClassName?.()??"";if(l(a)||function(e){return"Matrix"===e||"Matrix2D"===e||"Matrix3D"===e}(a))n[e]={value:t.asArray(),className:a};else if("FlowGraphInteger"===a)n[e]={value:t.value,className:a};else if(a&&(t.id||t.name))n[e]={id:t.id,name:t.name,className:a};else{if("object"==typeof t)throw new Error(`Could not serialize value ${t}`);n[e]=t}}function h(e,t,n,c){const u=t[e];let p;const d=u?.type??u?.className;if(function(e){return"Mesh"===e||"AbstractMesh"===e||"GroundMesh"===e||"InstanceMesh"===e||"LinesMesh"===e||"GoldbergMesh"===e||"GreasedLineMesh"===e||"TrailMesh"===e}(d)){let e=c.meshes.filter((e=>u.id?e.id===u.id:e.name===u.name));0===e.length&&(e=c.transformNodes.filter((e=>u.id?e.id===u.id:e.name===u.name))),p=u.uniqueId?e.find((e=>e.uniqueId===u.uniqueId)):e[0]}else if(l(d))p=function(e,t,n=!1){if("Vector2"===e)return o.I9.FromArray(t);if("Vector3"===e)return n&&(t[2]*=-1),o.Pq.FromArray(t);if("Vector4"===e)return o.IU.FromArray(t);if("Quaternion"===e)return n&&(t[2]*=-1,t[3]*=-1),o.PT.FromArray(t);if("Color3"===e)return new a.v9(t[0],t[1],t[2]);if("Color4"===e)return new a.ov(t[0],t[1],t[2],t[3]);throw new Error(`Unknown vector class name ${e}`)}(d,u.value);else if(function(e){return"AnimationGroup"===e}(d)){const e=c.animationGroups.filter((e=>e.name===u.name));p=1===e.length?e[0]:e.find((e=>e.uniqueId===u.uniqueId))}else p="Matrix"===d?o.uq.FromArray(u.value):"Matrix2D"===d?new r.K(u.value):"Matrix3D"===d?new r.z(u.value):"FlowGraphInteger"===d?i.P.FromValue(u.value):"number"===d||"string"===d||"boolean"===d?u.value[0]:u&&void 0!==u.value?u.value:Array.isArray(u)?u.reduce(((e,t)=>t.eventData?(e[t.id]={type:(0,s.Yd)(t.type)},void 0!==t.value&&(e[t.id].value=h("value",t,n,c)),e):e),{}):u;return p}function u(e){return"FlowGraphJsonPointerParserBlock"===e}},63683:(e,t,n)=>{n.d(t,{e:()=>c});var a=n(14858),o=n(72062),i=n(81661),s=n(2902),r=n(50697);class l extends i.X{constructor(e,t,n,a,o=a.defaultValue,i=!1){super(e,t,n),this.richType=a,this._defaultValue=o,this._optional=i,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new s.cP}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(e){this._isDisabled!==e&&(this._isDisabled=e,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(e,t){t._getConnectionValue(this)!==e&&(t._setConnectionValue(this,e),this.onValueChangedObservable.notifyObservers(e))}resetToDefaultValue(e){e._setConnectionValue(this,this._defaultValue)}connectTo(e){this._isDisabled||super.connectTo(e)}_getValueOrDefault(e){const t=e._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(t):t}getValue(e){if(1===this.connectionType){e._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(e);const t=this._getValueOrDefault(e);return this._lastValue=t,this.richType.typeTransformer?this.richType.typeTransformer(t):t}const t=this.isConnected()?this._connectedPoint[0].getValue(e):this._getValueOrDefault(e);return this._lastValue=t,this.richType.typeTransformer?this.richType.typeTransformer(t):t}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(e={}){super.serialize(e),e.richType={},this.richType.serialize(e.richType),e.optional=this._optional,(0,r.X5)("defaultValue",this._defaultValue,e)}}(0,o.Y5)("FlowGraphDataConnection",l);class c{constructor(e){this.config=e,this.uniqueId=(0,a.z)(),this.name=this.config?.name??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(e){}registerDataInput(e,t,n){const a=new l(e,0,this,t,n);return this.dataInputs.push(a),a}registerDataOutput(e,t,n){const a=new l(e,1,this,t,n);return this.dataOutputs.push(a),a}getDataInput(e){return this.dataInputs.find((t=>t.name===e))}getDataOutput(e){return this.dataOutputs.find((t=>t.name===e))}serialize(e={},t=r.X5){if(e.uniqueId=this.uniqueId,e.config={},this.config){const n=this.config,a=Object.keys(n);for(const o of a)t(o,n[o],e.config)}e.dataInputs=[],e.dataOutputs=[],e.className=this.getClassName();for(const t of this.dataInputs){const n={};t.serialize(n),e.dataInputs.push(n)}for(const t of this.dataOutputs){const n={};t.serialize(n),e.dataOutputs.push(n)}}deserialize(e){}_log(e,t,n){e.logger?.addLogItem({action:t,payload:n,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},66272:(e,t,n)=>{n.d(t,{w:()=>o});var a=n(21142);class o extends a.u{constructor(e){super(e),this.out=this._registerSignalOutput("out")}}},81661:(e,t,n)=>{n.d(t,{X:()=>i});var a,o=n(14858);!function(e){e[e.Input=0]="Input",e[e.Output=1]="Output"}(a||(a={}));class i{constructor(e,t,n){this._ownerBlock=n,this._connectedPoint=[],this.uniqueId=(0,o.z)(),this.connectedPointIds=[],this.name=e,this._connectionType=t}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(e){if(this._connectionType===e._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||e._isSingularConnection()&&e._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(e),e._connectedPoint.push(this)}disconnectFrom(e,t=!0){const n=this._connectedPoint.indexOf(e),a=e._connectedPoint.indexOf(this);-1!==n&&-1!==a&&(t&&this._connectedPoint.splice(n,1),e._connectedPoint.splice(a,1))}disconnectFromAll(){for(const e of this._connectedPoint)this.disconnectFrom(e,!1);this._connectedPoint.length=0}dispose(){for(const e of this._connectedPoint)this.disconnectFrom(e)}serialize(e={}){e.uniqueId=this.uniqueId,e.name=this.name,e._connectionType=this._connectionType,e.connectedPointIds=[],e.className=this.getClassName();for(const t of this._connectedPoint)e.connectedPointIds.push(t.uniqueId)}getClassName(){return"FGConnection"}deserialize(e){this.uniqueId=e.uniqueId,this.name=e.name,this._connectionType=e._connectionType,this.connectedPointIds=e.connectedPointIds}}},83612:(e,t,n)=>{n.d(t,{i:()=>o});var a=n(85858);class o extends a.M{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(e){e._notifyExecuteNode(this),this.done._activateSignal(e)}}},85858:(e,t,n)=>{n.d(t,{M:()=>o});var a=n(66272);class o extends a.w{constructor(e,t){if(super(e),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),t)for(const e of t)this._eventsSignalOutputs[e]=this._registerSignalOutput(e+"Event")}_executeOnTick(e){}_startPendingTasks(e){e._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(e),this._resetAfterCanceled(e)),this._preparePendingTasks(e),e._addPendingBlock(this),this.out._activateSignal(e),e._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(e){e._deleteExecutionVariable(this,"_initialized"),e._removePendingBlock(this)}}},88749:(e,t,n)=>{var a;function o(e,t,n,a){switch(t){case"Animation":return a?e.animations.find((e=>e.uniqueId===n))??null:e.animations[n]??null;case"AnimationGroup":return a?e.animationGroups.find((e=>e.uniqueId===n))??null:e.animationGroups[n]??null;case"Mesh":return a?e.meshes.find((e=>e.uniqueId===n))??null:e.meshes[n]??null;case"Material":return a?e.materials.find((e=>e.uniqueId===n))??null:e.materials[n]??null;case"Camera":return a?e.cameras.find((e=>e.uniqueId===n))??null:e.cameras[n]??null;case"Light":return a?e.lights.find((e=>e.uniqueId===n))??null:e.lights[n]??null;default:return null}}n.d(t,{N:()=>o}),function(e){e.Animation="Animation",e.AnimationGroup="AnimationGroup",e.Mesh="Mesh",e.Material="Material",e.Camera="Camera",e.Light="Light"}(a||(a={}))},92137:(e,t,n)=>{n.d(t,{x:()=>y});var a,o=n(2902),i=n(55823),s=n(88337),r=n(14858),l=n(50697),c=n(88749),h=n(83031);!function(e){e.ExecuteBlock="ExecuteBlock",e.ExecuteEvent="ExecuteEvent",e.TriggerConnection="TriggerConnection",e.ContextVariableSet="ContextVariableSet",e.GlobalVariableSet="GlobalVariableSet",e.GlobalVariableDelete="GlobalVariableDelete",e.GlobalVariableGet="GlobalVariableGet",e.AddConnection="AddConnection",e.GetConnectionValue="GetConnectionValue",e.SetConnectionValue="SetConnectionValue",e.ActivateSignal="ActivateSignal",e.ContextVariableGet="ContextVariableGet"}(a||(a={}));class u{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(e){if(e.time||(e.time=Date.now()),this.log.push(e),this.logToConsole){const t=e.payload?.value;"object"==typeof t&&t.getClassName?h.V.Log(`[FGLog] ${e.className}:${e.uniqueId.split("-")[0]} ${e.action} - ${JSON.stringify(t.getClassName())}: ${t.toString()}`):h.V.Log(`[FGLog] ${e.className}:${e.uniqueId.split("-")[0]} ${e.action} - ${JSON.stringify(e.payload)}`)}}getItemsOfType(e){return this.log.filter((t=>t.action===e))}}class p{get enableLogging(){return this._enableLogging}set enableLogging(e){this._enableLogging!==e&&(this._enableLogging=e,this._enableLogging?(this.logger=new u,this.logger.logToConsole=!0):this.logger=null)}constructor(e){this.uniqueId=(0,r.z)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new o.cP,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=e,this.assetsContext=e.assetsContext??e.scene}hasVariable(e){return e in this._userVariables}setVariable(e,t){this._userVariables[e]=t,this.logger?.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",payload:{name:e,value:t}})}getAsset(e,t){return(0,c.N)(this.assetsContext,e,t)}getVariable(e){return this.logger?.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",payload:{name:e,value:this._userVariables[e]}}),this._userVariables[e]}get userVariables(){return this._userVariables}getScene(){return this._configuration.scene}_getUniqueIdPrefixedName(e,t){return`${e.uniqueId}_${t}`}_getGlobalContextVariable(e,t){return this.logger?.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",payload:{name:e,defaultValue:t,possibleValue:this._globalContextVariables[e]}}),this._hasGlobalContextVariable(e)?this._globalContextVariables[e]:t}_setGlobalContextVariable(e,t){this.logger?.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",payload:{name:e,value:t}}),this._globalContextVariables[e]=t}_deleteGlobalContextVariable(e){this.logger?.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",payload:{name:e}}),delete this._globalContextVariables[e]}_hasGlobalContextVariable(e){return e in this._globalContextVariables}_setExecutionVariable(e,t,n){this._executionVariables[this._getUniqueIdPrefixedName(e,t)]=n}_getExecutionVariable(e,t,n){return this._hasExecutionVariable(e,t)?this._executionVariables[this._getUniqueIdPrefixedName(e,t)]:n}_deleteExecutionVariable(e,t){delete this._executionVariables[this._getUniqueIdPrefixedName(e,t)]}_hasExecutionVariable(e,t){return this._getUniqueIdPrefixedName(e,t)in this._executionVariables}_hasConnectionValue(e){return e.uniqueId in this._connectionValues}_setConnectionValue(e,t){this._connectionValues[e.uniqueId]=t,this.logger?.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",payload:{connectionPointId:e.uniqueId,value:t}})}_setConnectionValueByKey(e,t){this._connectionValues[e]=t}_getConnectionValue(e){return this.logger?.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",payload:{connectionPointId:e.uniqueId,value:this._connectionValues[e.uniqueId]}}),this._connectionValues[e.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(e){this._pendingBlocks.includes(e)||(this._pendingBlocks.push(e),this._pendingBlocks.sort(((e,t)=>e.priority-t.priority)))}_removePendingBlock(e){const t=this._pendingBlocks.indexOf(e);-1!==t&&this._pendingBlocks.splice(t,1)}_clearPendingBlocks(){for(const e of this._pendingBlocks)e._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(e){this.onNodeExecutedObservable.notifyObservers(e),this.logger?.addLogItem({time:Date.now(),className:e.getClassName(),uniqueId:e.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(e){this._setGlobalContextVariable("timeSinceStart",e.timeSinceStart),this._setGlobalContextVariable("deltaTime",e.deltaTime);for(const e of this._pendingBlocks)e._executeOnTick?.(this)}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(e={},t=l.X5){e.uniqueId=this.uniqueId,e._userVariables={};for(const n in this._userVariables)t(n,this._userVariables[n],e._userVariables);e._connectionValues={};for(const n in this._connectionValues)t(n,this._connectionValues[n],e._connectionValues);this.assetsContext!==this.getScene()&&(e._assetsContext={meshes:this.assetsContext.meshes.map((e=>e.id)),materials:this.assetsContext.materials.map((e=>e.id)),textures:this.assetsContext.textures.map((e=>e.name)),animations:this.assetsContext.animations.map((e=>e.name)),lights:this.assetsContext.lights.map((e=>e.id)),cameras:this.assetsContext.cameras.map((e=>e.id)),sounds:this.assetsContext.sounds?.map((e=>e.name)),skeletons:this.assetsContext.skeletons.map((e=>e.id)),particleSystems:this.assetsContext.particleSystems.map((e=>e.name)),geometries:this.assetsContext.geometries.map((e=>e.id)),multiMaterials:this.assetsContext.multiMaterials.map((e=>e.id)),transformNodes:this.assetsContext.transformNodes.map((e=>e.id))})}getClassName(){return"FlowGraphContext"}}(0,i.Cg)([(0,s.lK)()],p.prototype,"uniqueId",void 0);var d=n(21142),w=n(72046);class g{constructor(e){this.onEventTriggeredObservable=new o.cP,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=e,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.onDisposeObservable.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const e=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",payload:{timeSinceStart:this._startingTime,deltaTime:e}}),this._startingTime+=e})),this._meshPickedObserver=this._scene.onPointerObservable.add((e=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",payload:e})}),w.Zp.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((e=>{const t=e.pointerId,n=e.mesh,a=this._pointerUnderMeshState[t];!a&&n?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:t,mesh:n}}):a&&!n?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:t,mesh:a}}):a&&n&&a!==n&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:t,mesh:a,over:n}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:t,mesh:n,out:a}})),this._pointerUnderMeshState[t]=n}),w.Zp.POINTERMOVE)}dispose(){this._sceneDisposeObserver?.remove(),this._sceneReadyObserver?.remove(),this._sceneOnBeforeRenderObserver?.remove(),this._meshPickedObserver?.remove(),this._meshUnderPointerObserver?.remove(),this.onEventTriggeredObservable.clear()}}var f,b=n(8380);!function(e){e[e.Stopped=0]="Stopped",e[e.Started=1]="Started"}(f||(f={}));class m{get state(){return this._state}set state(e){this._state=e,this.onStateChangedObservable.notifyObservers(e)}constructor(e){this.onStateChangedObservable=new o.cP,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=e.scene,this._sceneEventCoordinator=new g(this._scene),this._coordinator=e.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((e=>{for(const t of this._executionContexts){const n=this._getContextualOrder(e.type,t);for(const a of n)if(!a._executeEvent(t,e.payload))break}switch(e.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const t of this._executionContexts)t._notifyOnTick(e.payload);break;case"SceneDispose":this.dispose()}}))}createContext(){const e=new p({scene:this._scene,coordinator:this._coordinator});return this._executionContexts.push(e),e}getContext(e){return this._executionContexts[e]}addEventBlock(e){if("PointerOver"!==e.type&&"PointerOut"!==e.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==e.type&&this._eventBlocks[e.type].push(e),1===this.state)for(const t of this._executionContexts)e._startPendingTasks(t);else this.onStateChangedObservable.addOnce((t=>{if(1===t)for(const t of this._executionContexts)e._startPendingTasks(t)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((e=>{1===e&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const e of this._executionContexts)for(const t in this._eventBlocks){const n=this._getContextualOrder(t,e);for(const t of n)t._startPendingTasks(e)}}_getContextualOrder(e,t){const n=this._eventBlocks[e].sort(((e,t)=>t.initPriority-e.initPriority));if("MeshPick"===e){const e=[];for(const a of n){const o=a.asset.getValue(t);let i=0;for(;i<n.length;i++){const e=n[i].asset.getValue(t);if(o&&e&&(0,b.Ah)(o,e))break}e.splice(i,0,a)}return e}return n}dispose(){if(0!==this.state){this.state=0;for(const e of this._executionContexts)e._clearPendingBlocks();this._executionContexts.length=0;for(const e in this._eventBlocks)this._eventBlocks[e].length=0;this._eventObserver?.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(e){const t=[],n=new Set;for(const e in this._eventBlocks)for(const a of this._eventBlocks[e])t.push(a),n.add(a.uniqueId);for(;t.length>0;){const a=t.pop();e(a);for(const e of a.dataInputs)for(const a of e._connectedPoint)n.has(a._ownerBlock.uniqueId)||(t.push(a._ownerBlock),n.add(a._ownerBlock.uniqueId));if(a instanceof d.u)for(const e of a.signalOutputs)for(const a of e._connectedPoint)n.has(a._ownerBlock.uniqueId)||(t.push(a._ownerBlock),n.add(a._ownerBlock.uniqueId))}}serialize(e={},t){e.allBlocks=[],this.visitAllBlocks((t=>{const n={};t.serialize(n),e.allBlocks.push(n)})),e.executionContexts=[];for(const n of this._executionContexts){const a={};n.serialize(a,t),e.executionContexts.push(a)}}}class y{constructor(e){this.config=e,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.scene.onDisposeObservable.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.scene.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const e=this._executeOnNextFrame.slice(0);if(e.length)for(const t of e){this.notifyCustomEvent(t.id,t.data,!1);const e=this._executeOnNextFrame.findIndex((e=>e.uniqueId===t.uniqueId));-1!==e&&this._executeOnNextFrame.splice(e,1)}})),(y.SceneCoordinators.get(this.config.scene)??[]).push(this)}createGraph(){const e=new m({scene:this.config.scene,coordinator:this});return this._flowGraphs.push(e),e}removeGraph(e){const t=this._flowGraphs.indexOf(e);-1!==t&&(e.dispose(),this._flowGraphs.splice(t,1))}start(){for(const e of this._flowGraphs)e.start()}dispose(){for(const e of this._flowGraphs)e.dispose();this._flowGraphs.length=0,this._disposeObserver?.remove(),this._onBeforeRenderObserver?.remove();const e=y.SceneCoordinators.get(this.config.scene)??[],t=e.indexOf(this);-1!==t&&e.splice(t,1)}serialize(e,t){e._flowGraphs=[];for(const n of this._flowGraphs){const a={};n.serialize(a,t),e._flowGraphs.push(a)}e.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(e){let t=this._customEventsMap.get(e);return t||(t=new o.cP,this._customEventsMap.set(e,t)),t}notifyCustomEvent(e,t,n=!this.dispatchEventsSynchronously){if(n)return void this._executeOnNextFrame.push({id:e,data:t,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(e)){const t=this._eventExecutionCounter.get(e);if(this._eventExecutionCounter.set(e,t+1),t>=y.MaxEventTypeExecutionPerFrame)return void(t===y.MaxEventTypeExecutionPerFrame&&h.V.Warn(`FlowGraphCoordinator: Too many executions of event "${e}".`))}else this._eventExecutionCounter.set(e,1);const a=this._customEventsMap.get(e);a&&a.notifyObservers(t)}}y.MaxEventsPerType=30,y.MaxEventTypeExecutionPerFrame=30,y.SceneCoordinators=new Map}}]);
//# sourceMappingURL=1106.bundle.js.map