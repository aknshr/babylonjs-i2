{"version":3,"file":"9695.bundle.js","mappings":"0NAWA,MAAMA,EAAO,sCAiBN,MAAMC,EAqBT,WAAAC,CAAYC,GAjBI,KAAAC,KAAOJ,EAUhB,KAAAK,MAAQ,IAQXC,KAAKC,QAAUJ,EACfG,KAAKE,QAAUF,KAAKC,QAAQE,gBAAgBT,EAChD,CAGO,OAAAU,GACFJ,KAAKC,QAAkB,IAC5B,CAMO,2BAAAI,CAA4BC,EAAiBC,EAAqBC,GACrE,OAAO,KAAWC,mBAAuDH,EAASC,EAAUP,KAAKF,MAAMY,MAAOC,EAAkBC,KAC5H,MAAMC,EAAW,IAAIC,MAKrB,OAJAD,EAASE,KAAKf,KAAKC,QAAQe,gCAAgCV,EAASC,EAAUC,IAC9EK,EAASE,KAAKf,KAAKiB,uCAAuCN,EAAkBC,EAAWJ,IACvFR,KAAKC,QAAQiB,4BAA4BZ,EAASC,EAAUC,SAE/CW,QAAQC,IAAIP,GAAUQ,MAAK,WAEhD,CAGQ,sCAAAJ,CAAuCX,EAAiBgB,EAAgDd,GAC5G,KAAMA,aAA2B,EAAAe,aAC7B,MAAM,IAAIC,MAAM,GAAGlB,kCAGvB,MAAMO,EAAW,IAAIC,MAqCrB,OAnCAN,EAAgBiB,SAAW,KAC3BjB,EAAgBkB,UAAY,KAExBJ,EAAWK,eACXnB,EAAgBoB,YAAc,KAAOC,UAAUP,EAAWK,eAC1DnB,EAAgBsB,MAAQR,EAAWK,cAAc,IAEjDnB,EAAgBoB,YAAc,KAAOG,QAGzCvB,EAAgBwB,kBAAoBV,EAAWW,eAAiB,KAAOJ,UAAUP,EAAWW,gBAAkB,KAAOF,QACrHvB,EAAgB0B,aAA8CC,MAA/Bb,EAAWc,iBAAgC,EAAId,EAAWc,iBAErFd,EAAWe,gBACXxB,EAASE,KACLf,KAAKC,QAAQqC,qBAAqB,GAAGhC,mBAA0BgB,EAAWe,gBAAiBE,IACvFA,EAAQzC,KAAO,GAAGU,EAAgBV,iBAClCU,EAAgBgC,cAAgBD,MAKxCjB,EAAWmB,4BACX5B,EAASE,KACLf,KAAKC,QAAQqC,qBAAqB,GAAGhC,8BAAqCgB,EAAWmB,2BAA4BF,IAC7GA,EAAQzC,KAAO,GAAGU,EAAgBV,6BAClCU,EAAgBkC,oBAAsBH,EACtC/B,EAAgBkC,oBAAoBC,UAAW,MAIvDnC,EAAgBoC,yCAA0C,GAIvDzB,QAAQC,IAAIP,GAAUQ,MAAK,QACtC,GAGJ,QAAwB3B,IACxB,QAAsBA,GAAM,GAAOG,GAAW,IAAIF,EAAoCE,I","sources":["webpack://@dev/inspector-v2/../loaders/src/glTF/2.0/Extensions/KHR_materials_pbrSpecularGlossiness.ts?"],"sourcesContent":["import type { Nullable } from \"core/types\";\r\nimport { Color3 } from \"core/Maths/math.color\";\r\nimport { PBRMaterial } from \"core/Materials/PBR/pbrMaterial\";\r\nimport type { Material } from \"core/Materials/material\";\r\n\r\nimport type { IMaterial } from \"../glTFLoaderInterfaces\";\r\nimport type { IGLTFLoaderExtension } from \"../glTFLoaderExtension\";\r\nimport { GLTFLoader } from \"../glTFLoader\";\r\nimport type { IKHRMaterialsPbrSpecularGlossiness } from \"babylonjs-gltf2interface\";\r\nimport { registerGLTFExtension, unregisterGLTFExtension } from \"../glTFLoaderExtensionRegistry\";\r\n\r\nconst NAME = \"KHR_materials_pbrSpecularGlossiness\";\r\n\r\ndeclare module \"../../glTFFileLoader\" {\r\n    // eslint-disable-next-line jsdoc/require-jsdoc, @typescript-eslint/naming-convention\r\n    export interface GLTFLoaderExtensionOptions {\r\n        /**\r\n         * Defines options for the KHR_materials_pbrSpecularGlossiness extension.\r\n         */\r\n        // NOTE: Don't use NAME here as it will break the UMD type declarations.\r\n        [\"KHR_materials_pbrSpecularGlossiness\"]: {};\r\n    }\r\n}\r\n\r\n/**\r\n * [Specification](https://github.com/KhronosGroup/glTF/blob/main/extensions/2.0/Archived/KHR_materials_pbrSpecularGlossiness/README.md)\r\n */\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\nexport class KHR_materials_pbrSpecularGlossiness implements IGLTFLoaderExtension {\r\n    /**\r\n     * The name of this extension.\r\n     */\r\n    public readonly name = NAME;\r\n\r\n    /**\r\n     * Defines whether this extension is enabled.\r\n     */\r\n    public enabled: boolean;\r\n\r\n    /**\r\n     * Defines a number that determines the order the extensions are applied.\r\n     */\r\n    public order = 200;\r\n\r\n    private _loader: GLTFLoader;\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    constructor(loader: GLTFLoader) {\r\n        this._loader = loader;\r\n        this.enabled = this._loader.isExtensionUsed(NAME);\r\n    }\r\n\r\n    /** @internal */\r\n    public dispose() {\r\n        (this._loader as any) = null;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    // eslint-disable-next-line no-restricted-syntax\r\n    public loadMaterialPropertiesAsync(context: string, material: IMaterial, babylonMaterial: Material): Nullable<Promise<void>> {\r\n        return GLTFLoader.LoadExtensionAsync<IKHRMaterialsPbrSpecularGlossiness>(context, material, this.name, async (extensionContext, extension) => {\r\n            const promises = new Array<Promise<any>>();\r\n            promises.push(this._loader.loadMaterialBasePropertiesAsync(context, material, babylonMaterial));\r\n            promises.push(this._loadSpecularGlossinessPropertiesAsync(extensionContext, extension, babylonMaterial));\r\n            this._loader.loadMaterialAlphaProperties(context, material, babylonMaterial);\r\n            // eslint-disable-next-line github/no-then\r\n            return await Promise.all(promises).then(() => {});\r\n        });\r\n    }\r\n\r\n    // eslint-disable-next-line @typescript-eslint/promise-function-async, no-restricted-syntax\r\n    private _loadSpecularGlossinessPropertiesAsync(context: string, properties: IKHRMaterialsPbrSpecularGlossiness, babylonMaterial: Material): Promise<void> {\r\n        if (!(babylonMaterial instanceof PBRMaterial)) {\r\n            throw new Error(`${context}: Material type not supported`);\r\n        }\r\n\r\n        const promises = new Array<Promise<any>>();\r\n\r\n        babylonMaterial.metallic = null;\r\n        babylonMaterial.roughness = null;\r\n\r\n        if (properties.diffuseFactor) {\r\n            babylonMaterial.albedoColor = Color3.FromArray(properties.diffuseFactor);\r\n            babylonMaterial.alpha = properties.diffuseFactor[3];\r\n        } else {\r\n            babylonMaterial.albedoColor = Color3.White();\r\n        }\r\n\r\n        babylonMaterial.reflectivityColor = properties.specularFactor ? Color3.FromArray(properties.specularFactor) : Color3.White();\r\n        babylonMaterial.microSurface = properties.glossinessFactor == undefined ? 1 : properties.glossinessFactor;\r\n\r\n        if (properties.diffuseTexture) {\r\n            promises.push(\r\n                this._loader.loadTextureInfoAsync(`${context}/diffuseTexture`, properties.diffuseTexture, (texture) => {\r\n                    texture.name = `${babylonMaterial.name} (Diffuse)`;\r\n                    babylonMaterial.albedoTexture = texture;\r\n                })\r\n            );\r\n        }\r\n\r\n        if (properties.specularGlossinessTexture) {\r\n            promises.push(\r\n                this._loader.loadTextureInfoAsync(`${context}/specularGlossinessTexture`, properties.specularGlossinessTexture, (texture) => {\r\n                    texture.name = `${babylonMaterial.name} (Specular Glossiness)`;\r\n                    babylonMaterial.reflectivityTexture = texture;\r\n                    babylonMaterial.reflectivityTexture.hasAlpha = true;\r\n                })\r\n            );\r\n\r\n            babylonMaterial.useMicroSurfaceFromReflectivityMapAlpha = true;\r\n        }\r\n\r\n        // eslint-disable-next-line github/no-then\r\n        return Promise.all(promises).then(() => {});\r\n    }\r\n}\r\n\r\nunregisterGLTFExtension(NAME);\r\nregisterGLTFExtension(NAME, true, (loader) => new KHR_materials_pbrSpecularGlossiness(loader));\r\n"],"names":["NAME","KHR_materials_pbrSpecularGlossiness","constructor","loader","name","order","this","_loader","enabled","isExtensionUsed","dispose","loadMaterialPropertiesAsync","context","material","babylonMaterial","LoadExtensionAsync","async","extensionContext","extension","promises","Array","push","loadMaterialBasePropertiesAsync","_loadSpecularGlossinessPropertiesAsync","loadMaterialAlphaProperties","Promise","all","then","properties","PBRMaterial","Error","metallic","roughness","diffuseFactor","albedoColor","FromArray","alpha","White","reflectivityColor","specularFactor","microSurface","undefined","glossinessFactor","diffuseTexture","loadTextureInfoAsync","texture","albedoTexture","specularGlossinessTexture","reflectivityTexture","hasAlpha","useMicroSurfaceFromReflectivityMapAlpha"],"ignoreList":[],"sourceRoot":""}