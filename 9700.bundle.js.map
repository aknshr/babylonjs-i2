{"version":3,"file":"9700.bundle.js","mappings":"4MA0BO,MAAMA,UAAqC,IAC9C,WAAAC,CAAYC,GAGR,GAFAC,MAAMD,IAEDA,EAAOE,WAAaF,EAAOG,UAC5B,MAAM,IAAIC,MAAM,gEAGpB,GAAIJ,EAAOG,WAAaH,EAAOE,SAC3B,MAAM,IAAIE,MAAM,sEAGpB,GAAIJ,EAAOG,UACP,IAAK,MAAMD,KAAYF,EAAOG,UAC1BE,KAAKC,kBAAkBJ,EAAU,WAGrCG,KAAKC,kBAAkB,QAAS,KAExC,CAEgB,QAAAC,CAASC,EAA2BC,GAChD,GAAIJ,KAAKL,QAAQG,UACb,IAAK,MAAMD,KAAYG,KAAKL,OAAOG,UAC/BE,KAAKK,cAAcF,EAASN,QAGhCG,KAAKK,cAAcF,EAASH,KAAKL,QAAQE,SAAU,SAEvDG,KAAKM,IAAIC,gBAAgBJ,EAC7B,CAEQ,aAAAE,CAAcF,EAA2BK,EAAsBC,GAEnE,MAAMC,EAAkCP,EAAQQ,0BAA0B,kCAAmC,IAC7G,IAAK,MAAMC,KAAqBF,EAAiC,CAC7D,MAAMG,EAAiBV,EAAQW,cAAcC,gBAAgBC,MAAMH,GAAmBA,EAAeI,UAAYL,IACjH,GAAIC,EAEA,IAAK,MAAMK,KAAmBL,EAAeM,mBAEzC,GAAID,EAAgBE,SAAWjB,GAEvBe,EAAgBG,UAAUC,iBAAmBd,EAAc,CAE3DK,EAAeU,OAEf,MAAMC,EAAQd,EAAgCe,QAAQb,GAClDY,GAAS,GACTd,EAAgCgB,OAAOF,EAAO,GAElDrB,EAAQwB,0BAA0B,kCAAmCjB,GACrE,KACJ,CAIhB,CACA,MAAMkB,EAAQ5B,KAAK6B,aAAapB,GAAaD,IAAesB,SAAS3B,GACrEA,EAAQ4B,YAAYvB,EAAcoB,EACtC,CAEgB,YAAAI,GACZ,MAAO,2BACX,CAEgB,SAAAC,CAAUC,GACtBtC,MAAMqC,UAAUC,GAChBA,EAAoBvC,OAAOE,SAAWG,KAAKL,QAAQE,QACvD,GAGJ,QAAc,4BAAiCJ,E","sources":["webpack://@dev/inspector-v2/../core/src/FlowGraph/Blocks/Execution/flowGraphSetVariableBlock.ts?"],"sourcesContent":["import { RegisterClass } from \"core/Misc/typeStore\";\nimport type { IFlowGraphBlockConfiguration } from \"../../flowGraphBlock\";\nimport type { FlowGraphContext } from \"../../flowGraphContext\";\nimport { FlowGraphExecutionBlockWithOutSignal } from \"../../flowGraphExecutionBlockWithOutSignal\";\nimport type { FlowGraphSignalConnection } from \"../../flowGraphSignalConnection\";\nimport { FlowGraphBlockNames } from \"../flowGraphBlockNames\";\nimport { RichTypeAny } from \"core/FlowGraph/flowGraphRichTypes\";\n\n/**\n * The configuration of the FlowGraphGetVariableBlock.\n */\nexport interface IFlowGraphSetVariableBlockConfiguration extends IFlowGraphBlockConfiguration {\n    /**\n     * The name of the variable to set.\n     */\n    variable?: string;\n\n    /**\n     * The name of the variables to set.\n     */\n    variables?: string[];\n}\n\n/**\n * This block will set a variable on the context.\n */\nexport class FlowGraphSetVariableBlock<T> extends FlowGraphExecutionBlockWithOutSignal {\n    constructor(config: IFlowGraphSetVariableBlockConfiguration) {\n        super(config);\n        // check if the variable is defined\n        if (!config.variable && !config.variables) {\n            throw new Error(\"FlowGraphSetVariableBlock: variable/variables is not defined\");\n        }\n        // check if the variable is an array\n        if (config.variables && config.variable) {\n            throw new Error(\"FlowGraphSetVariableBlock: variable and variables are both defined\");\n        }\n        // check if we have either a variable or variables. If we have variables, set the inputs correctly\n        if (config.variables) {\n            for (const variable of config.variables) {\n                this.registerDataInput(variable, RichTypeAny);\n            }\n        } else {\n            this.registerDataInput(\"value\", RichTypeAny);\n        }\n    }\n\n    public override _execute(context: FlowGraphContext, _callingSignal: FlowGraphSignalConnection): void {\n        if (this.config?.variables) {\n            for (const variable of this.config.variables) {\n                this._saveVariable(context, variable);\n            }\n        } else {\n            this._saveVariable(context, this.config?.variable, \"value\");\n        }\n        this.out._activateSignal(context);\n    }\n\n    private _saveVariable(context: FlowGraphContext, variableName: string, inputName?: string): void {\n        // check if there is an animation(group) running on this variable. If there is, stop the animation - a value was force-set.\n        const currentlyRunningAnimationGroups = context._getGlobalContextVariable(\"currentlyRunningAnimationGroups\", []) as number[];\n        for (const animationUniqueId of currentlyRunningAnimationGroups) {\n            const animationGroup = context.assetsContext.animationGroups.find((animationGroup) => animationGroup.uniqueId == animationUniqueId);\n            if (animationGroup) {\n                // check if there is a target animation that has the target set to be the context\n                for (const targetAnimation of animationGroup.targetedAnimations) {\n                    // check if the target property is the variable we are setting\n                    if (targetAnimation.target === context) {\n                        // check the variable name\n                        if (targetAnimation.animation.targetProperty === variableName) {\n                            // stop the animation\n                            animationGroup.stop();\n                            // remove the animation from the currently running animations\n                            const index = currentlyRunningAnimationGroups.indexOf(animationUniqueId);\n                            if (index > -1) {\n                                currentlyRunningAnimationGroups.splice(index, 1);\n                            }\n                            context._setGlobalContextVariable(\"currentlyRunningAnimationGroups\", currentlyRunningAnimationGroups);\n                            break;\n                        }\n                    }\n                }\n            }\n        }\n        const value = this.getDataInput(inputName || variableName)?.getValue(context);\n        context.setVariable(variableName, value);\n    }\n\n    public override getClassName(): string {\n        return FlowGraphBlockNames.SetVariable;\n    }\n\n    public override serialize(serializationObject?: any): void {\n        super.serialize(serializationObject);\n        serializationObject.config.variable = this.config?.variable;\n    }\n}\n\nRegisterClass(FlowGraphBlockNames.SetVariable, FlowGraphSetVariableBlock);\n"],"names":["FlowGraphSetVariableBlock","constructor","config","super","variable","variables","Error","this","registerDataInput","_execute","context","_callingSignal","_saveVariable","out","_activateSignal","variableName","inputName","currentlyRunningAnimationGroups","_getGlobalContextVariable","animationUniqueId","animationGroup","assetsContext","animationGroups","find","uniqueId","targetAnimation","targetedAnimations","target","animation","targetProperty","stop","index","indexOf","splice","_setGlobalContextVariable","value","getDataInput","getValue","setVariable","getClassName","serialize","serializationObject"],"ignoreList":[],"sourceRoot":""}