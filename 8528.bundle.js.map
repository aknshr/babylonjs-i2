{"version":3,"file":"8528.bundle.js","mappings":"iMAQA,MAAMA,EAAO,0BAcb,QAAoC,iBAAkBA,EAAM,CAExDC,OAAQ,CAAC,8BAAD,oDAAkG,+CAC1GC,cAAe,CACXC,gBAAiB,CAAEC,KAAM,mBACzBC,UAAW,CACPD,KAAM,WACNE,QAAS,4BACTC,gBAAgBC,GACL,cAAgBA,IAInCC,QAAS,CACLC,OAAQ,CACJC,kBAAmB,CAAEP,KAAM,QAASE,QAAS,yBAC7CM,gBAAiB,CAAER,KAAM,aACzBS,eAAgB,CAAET,KAAM,eACxBU,mBAAoB,CAAEV,KAAM,eAEhCW,MAAO,CACHC,IAAK,CAAEZ,KAAM,UAGrBa,qBAAsB,CAClB,CACIC,MAAO,QACPC,OAAQ,QACRC,gBAAiB,EACjBC,iBAAkB,EAClBC,YAAY,GAEhB,CACIJ,MAAO,QACPC,OAAQ,QACRC,gBAAiB,EACjBC,iBAAkB,EAClBC,YAAY,GAEhB,CACIJ,MAAO,SACPC,OAAQ,aACRC,gBAAiB,EACjBC,iBAAkB,EAClBC,YAAY,IAGpB,cAAAC,CAAeC,EAAWC,EAAcC,EAAUC,EAASC,EAAmBC,EAASC,GAEnF,MAAMC,EAAmBH,EAAkBA,EAAkBI,OAAS,GACtED,EAAiBE,OAASF,EAAiBE,QAAU,CAAC,EACtDF,EAAiBE,OAAOC,KAAOJ,EAE/B,MAAMzB,EAAYmB,EAAUtB,eAA2B,WAAGiC,QAAQ,GAClE,QAAkBC,IAAd/B,GAAgD,iBAAdA,EAClC,MAAM,IAAIgC,MAAM,wCAEpB,MAAMC,EAAe,cAAgBjC,EAQrC,OANAuB,EAAkB,GAAGK,OAAOM,SAAWD,EACvCT,EAAQW,eAAeF,GAAgB,CACnCG,UAAW,OACXC,GAAIZ,GAAYa,QAAQtC,GAAWuC,uBAAuBF,GAC1DG,SAAUf,GAAYa,QAAQtC,GAAWuC,uBAAuBC,UAE7DjB,CACX,KAIJ,QAAuB,yDAA0D,CAC7EkB,IAAMC,IACF,MAAMC,EAAKD,EAAKH,sBAChB,OAAII,QAAwBZ,IAAlBY,EAAGC,YACFD,EAAGC,YAIlBC,IAAK,CAACf,EAAgBY,KAClBA,EAAKI,yBAAyBC,SAASC,IACnCA,EAAKJ,WAAad,MAG1BmB,UAAYP,GAAgBA,EAAKH,sBACjCW,gBAAiB,CAAC,IAAM,cACxBC,KAAM,YAOH,MAAMC,EAeT,WAAAC,CAAYC,GAXI,KAAAvD,KAAOJ,EAYnB4D,KAAKC,QAAUF,EACfC,KAAKE,QAAUH,EAAOI,gBAAgB/D,EAC1C,CAGO,aAAMgE,GACTJ,KAAKC,QAAQI,KAAKtB,OAAOS,SAASL,IAC1BA,EAAKmB,YAAYT,yBAAiF,IAAvDV,EAAKmB,YAAYT,uBAAuBU,YACnFpB,EAAKH,uBAAuBwB,iBAAiBhB,SAASC,IAClDA,EAAKJ,YAAa,OAIlC,CAEO,OAAAoB,GACFT,KAAKC,QAAkB,IAC5B,GAGJ,QAAwB7D,IACxB,QAAsBA,GAAM,GAAO2D,GAAW,IAAIF,EAAuBE,I","sources":["webpack://@dev/inspector-v2/../loaders/src/glTF/2.0/Extensions/KHR_node_selectability.ts?"],"sourcesContent":["import { FlowGraphBlockNames } from \"core/FlowGraph/Blocks/flowGraphBlockNames\";\nimport type { GLTFLoader } from \"../glTFLoader\";\nimport type { IGLTFLoaderExtension } from \"../glTFLoaderExtension\";\nimport { registerGLTFExtension, unregisterGLTFExtension } from \"../glTFLoaderExtensionRegistry\";\nimport { addNewInteractivityFlowGraphMapping } from \"./KHR_interactivity/declarationMapper\";\nimport type { INode } from \"../glTFLoaderInterfaces\";\nimport { AddObjectAccessorToKey } from \"./objectModelMapping\";\n\nconst NAME = \"KHR_node_selectability\";\n\ndeclare module \"../../glTFFileLoader\" {\n    // eslint-disable-next-line jsdoc/require-jsdoc, @typescript-eslint/naming-convention\n    export interface GLTFLoaderExtensionOptions {\n        /**\n         * Defines options for the KHR_selectability extension.\n         */\n        // NOTE: Don't use NAME here as it will break the UMD type declarations.\n        [\"KHR_node_selectability\"]: {};\n    }\n}\n\n// add the interactivity mapping for the onSelect event\naddNewInteractivityFlowGraphMapping(\"event/onSelect\", NAME, {\n    // using GetVariable as the nodeIndex is a configuration and not a value (i.e. it's not mutable)\n    blocks: [FlowGraphBlockNames.MeshPickEvent, FlowGraphBlockNames.GetVariable, FlowGraphBlockNames.IndexOf, \"KHR_interactivity/FlowGraphGLTFDataProvider\"],\n    configuration: {\n        stopPropagation: { name: \"stopPropagation\" },\n        nodeIndex: {\n            name: \"variable\",\n            toBlock: FlowGraphBlockNames.GetVariable,\n            dataTransformer(data) {\n                return \"pickedMesh_\" + data;\n            },\n        },\n    },\n    outputs: {\n        values: {\n            selectedNodeIndex: { name: \"index\", toBlock: FlowGraphBlockNames.IndexOf },\n            controllerIndex: { name: \"pointerId\" },\n            selectionPoint: { name: \"pickedPoint\" },\n            selectionRayOrigin: { name: \"pickOrigin\" },\n        },\n        flows: {\n            out: { name: \"done\" },\n        },\n    },\n    interBlockConnectors: [\n        {\n            input: \"asset\",\n            output: \"value\",\n            inputBlockIndex: 0,\n            outputBlockIndex: 1,\n            isVariable: true,\n        },\n        {\n            input: \"array\",\n            output: \"nodes\",\n            inputBlockIndex: 2,\n            outputBlockIndex: 3,\n            isVariable: true,\n        },\n        {\n            input: \"object\",\n            output: \"pickedMesh\",\n            inputBlockIndex: 2,\n            outputBlockIndex: 0,\n            isVariable: true,\n        },\n    ],\n    extraProcessor(gltfBlock, _declaration, _mapping, _arrays, serializedObjects, context, globalGLTF) {\n        // add the glTF to the configuration of the last serialized object\n        const serializedObject = serializedObjects[serializedObjects.length - 1];\n        serializedObject.config = serializedObject.config || {};\n        serializedObject.config.glTF = globalGLTF;\n        // find the listener nodeIndex value\n        const nodeIndex = gltfBlock.configuration?.[\"nodeIndex\"]?.value?.[0];\n        if (nodeIndex === undefined || typeof nodeIndex !== \"number\") {\n            throw new Error(\"nodeIndex not found in configuration\");\n        }\n        const variableName = \"pickedMesh_\" + nodeIndex;\n        // find the nodeIndex value\n        serializedObjects[1].config.variable = variableName;\n        context._userVariables[variableName] = {\n            className: \"Mesh\",\n            id: globalGLTF?.nodes?.[nodeIndex]._babylonTransformNode?.id,\n            uniqueId: globalGLTF?.nodes?.[nodeIndex]._babylonTransformNode?.uniqueId,\n        };\n        return serializedObjects;\n    },\n});\n\n// object model extension for selectable\nAddObjectAccessorToKey(\"/nodes/{}/extensions/KHR_node_selectability/selectable\", {\n    get: (node: INode) => {\n        const tn = node._babylonTransformNode as any;\n        if (tn && tn.isPickable !== undefined) {\n            return tn.isPickable;\n        }\n        return true;\n    },\n    set: (value: boolean, node: INode) => {\n        node._primitiveBabylonMeshes?.forEach((mesh) => {\n            mesh.isPickable = value;\n        });\n    },\n    getTarget: (node: INode) => node._babylonTransformNode,\n    getPropertyName: [() => \"isPickable\"],\n    type: \"boolean\",\n});\n\n/**\n * Loader extension for KHR_selectability\n */\n// eslint-disable-next-line @typescript-eslint/naming-convention\nexport class KHR_node_selectability implements IGLTFLoaderExtension {\n    /**\n     * The name of this extension.\n     */\n    public readonly name = NAME;\n    /**\n     * Defines whether this extension is enabled.\n     */\n    public enabled: boolean;\n\n    private _loader: GLTFLoader;\n\n    /**\n     * @internal\n     */\n    constructor(loader: GLTFLoader) {\n        this._loader = loader;\n        this.enabled = loader.isExtensionUsed(NAME);\n    }\n\n    // eslint-disable-next-line @typescript-eslint/naming-convention, @typescript-eslint/no-misused-promises\n    public async onReady(): Promise<void> {\n        this._loader.gltf.nodes?.forEach((node) => {\n            if (node.extensions?.KHR_node_selectability && node.extensions?.KHR_node_selectability.selectable === false) {\n                node._babylonTransformNode?.getChildMeshes().forEach((mesh) => {\n                    mesh.isPickable = false;\n                });\n            }\n        });\n    }\n\n    public dispose() {\n        (this._loader as any) = null;\n    }\n}\n\nunregisterGLTFExtension(NAME);\nregisterGLTFExtension(NAME, true, (loader) => new KHR_node_selectability(loader));\n"],"names":["NAME","blocks","configuration","stopPropagation","name","nodeIndex","toBlock","dataTransformer","data","outputs","values","selectedNodeIndex","controllerIndex","selectionPoint","selectionRayOrigin","flows","out","interBlockConnectors","input","output","inputBlockIndex","outputBlockIndex","isVariable","extraProcessor","gltfBlock","_declaration","_mapping","_arrays","serializedObjects","context","globalGLTF","serializedObject","length","config","glTF","value","undefined","Error","variableName","variable","_userVariables","className","id","nodes","_babylonTransformNode","uniqueId","get","node","tn","isPickable","set","_primitiveBabylonMeshes","forEach","mesh","getTarget","getPropertyName","type","KHR_node_selectability","constructor","loader","this","_loader","enabled","isExtensionUsed","onReady","gltf","extensions","selectable","getChildMeshes","dispose"],"ignoreList":[],"sourceRoot":""}