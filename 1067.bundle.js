"use strict";(self.webpackChunk_dev_inspector_v2=self.webpackChunk_dev_inspector_v2||[]).push([[1067],{51067:(e,t,s)=>{s.d(t,{WZ:()=>g});var o=s(74421),n=s(76930),i=s(28216),r=s(83031),a=s(23473),h=s(56750),c=s(14390),d=s(45426),f=s(21148),l=s(97986);class m{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.particleSystems=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.sounds=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(e){this._environmentTexture=e}getNodes(){let e=[];e=e.concat(this.meshes),e=e.concat(this.lights),e=e.concat(this.cameras),e=e.concat(this.transformNodes);for(const t of this.skeletons)e=e.concat(t.bones);return e}}class u extends m{}class p{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const e=this.rootNodes;for(const t of e)t.dispose();e.length=0;const t=this.skeletons;for(const e of t)e.dispose();t.length=0;const s=this.animationGroups;for(const e of s)e.dispose();s.length=0}}class g extends m{constructor(e){super(),this._wasAddedToScene=!1,(e=e||a.q.LastCreatedScene)&&(this.scene=e,this.proceduralTextures=[],e.onDisposeObservable.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=e.getEngine().onContextRestoredObservable.add((()=>{for(const e of this.geometries)e._rebuild();for(const e of this.meshes)e._rebuild();for(const e of this.particleSystems)e.rebuild();for(const e of this.textures)e._rebuild()})))}_topologicalSort(e){const t=new Map;for(const s of e)t.set(s.uniqueId,s);const s={dependsOn:new Map,dependedBy:new Map};for(const t of e){const e=t.uniqueId;s.dependsOn.set(e,new Set),s.dependedBy.set(e,new Set)}for(const o of e){const e=o.uniqueId,n=s.dependsOn.get(e);if(o instanceof h.Z){const i=o.sourceMesh;t.has(i.uniqueId)&&(n.add(i.uniqueId),s.dependedBy.get(i.uniqueId).add(e))}const i=s.dependedBy.get(e);for(const n of o.getDescendants()){const o=n.uniqueId;t.has(o)&&(i.add(o),s.dependsOn.get(o).add(e))}}const o=[],n=[];for(const o of e){const e=o.uniqueId;0===s.dependsOn.get(e).size&&(n.push(o),t.delete(e))}const i=n;for(;i.length>0;){const e=i.shift();o.push(e);const n=s.dependedBy.get(e.uniqueId);for(const o of Array.from(n.values())){const n=s.dependsOn.get(o);n.delete(e.uniqueId),0===n.size&&t.get(o)&&(i.push(t.get(o)),t.delete(o))}}return t.size>0&&(r.V.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),t.forEach((e=>{r.V.Error(e.name)}))),o}_addNodeAndDescendantsToList(e,t,s,o){if(s&&(!o||o(s))&&!t.has(s.uniqueId)){e.push(s),t.add(s.uniqueId);for(const n of s.getDescendants(!0))this._addNodeAndDescendantsToList(e,t,n,o)}}_isNodeInContainer(e){return e instanceof i.u&&-1!==this.meshes.indexOf(e)||e instanceof n.V&&-1!==this.transformNodes.indexOf(e)||e instanceof c.v&&-1!==this.lights.indexOf(e)||e instanceof d.i&&-1!==this.cameras.indexOf(e)}_isValidHierarchy(){for(const e of this.meshes)if(e.parent&&!this._isNodeInContainer(e.parent))return r.V.Warn(`Node ${e.name} has a parent that is not in the container.`),!1;for(const e of this.transformNodes)if(e.parent&&!this._isNodeInContainer(e.parent))return r.V.Warn(`Node ${e.name} has a parent that is not in the container.`),!1;for(const e of this.lights)if(e.parent&&!this._isNodeInContainer(e.parent))return r.V.Warn(`Node ${e.name} has a parent that is not in the container.`),!1;for(const e of this.cameras)if(e.parent&&!this._isNodeInContainer(e.parent))return r.V.Warn(`Node ${e.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(e,t=!1,s){this._isValidHierarchy()||f.S0.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const n={},i={},r=new p,a=[],h=[],c={doNotInstantiate:!0,...s},d=[],l=new Set;for(const e of this.transformNodes)null===e.parent&&this._addNodeAndDescendantsToList(d,l,e,c.predicate);for(const e of this.meshes)null===e.parent&&this._addNodeAndDescendantsToList(d,l,e,c.predicate);const m=this._topologicalSort(d),u=(s,a)=>{if(((t,s)=>{if(n[t.uniqueId]=s.uniqueId,i[s.uniqueId]=s,e&&(s.name=e(t.name)),s instanceof o.e){const e=s;if(e.morphTargetManager){const s=t.morphTargetManager;e.morphTargetManager=s.clone();for(let t=0;t<s.numTargets;t++){const o=s.getTarget(t),r=e.morphTargetManager.getTarget(t);n[o.uniqueId]=r.uniqueId,i[r.uniqueId]=r}}}})(s,a),s.parent){const e=n[s.parent.uniqueId],t=i[e];a.parent=t||s.parent}if(a.position&&s.position&&a.position.copyFrom(s.position),a.rotationQuaternion&&s.rotationQuaternion&&a.rotationQuaternion.copyFrom(s.rotationQuaternion),a.rotation&&s.rotation&&a.rotation.copyFrom(s.rotation),a.scaling&&s.scaling&&a.scaling.copyFrom(s.scaling),a.material){const o=a;if(o.material)if(t){const t=s.material;if(-1===h.indexOf(t)){let s=t.clone(e?e(t.name):"Clone of "+t.name);if(h.push(t),n[t.uniqueId]=s.uniqueId,i[s.uniqueId]=s,"MultiMaterial"===t.getClassName()){const o=t;for(const t of o.subMaterials)t&&(s=t.clone(e?e(t.name):"Clone of "+t.name),h.push(t),n[t.uniqueId]=s.uniqueId,i[s.uniqueId]=s);o.subMaterials=o.subMaterials.map((e=>e&&i[n[e.uniqueId]]))}}"InstancedMesh"!==o.getClassName()&&(o.material=i[n[t.uniqueId]])}else"MultiMaterial"===o.material.getClassName()?-1===this.scene.multiMaterials.indexOf(o.material)&&this.scene.addMultiMaterial(o.material):-1===this.scene.materials.indexOf(o.material)&&this.scene.addMaterial(o.material)}null===a.parent&&r.rootNodes.push(a)};for(const e of m)if("InstancedMesh"===e.getClassName()){const t=e,s=t.sourceMesh,o=n[s.uniqueId];u(t,("number"==typeof o?i[o]:s).createInstance(t.name))}else{let t=!0;"TransformNode"===e.getClassName()||"Node"===e.getClassName()||e.skeleton||!e.getTotalVertices||0===e.getTotalVertices()?t=!1:c.doNotInstantiate&&(t="function"==typeof c.doNotInstantiate?!c.doNotInstantiate(e):!c.doNotInstantiate);const s=t?e.createInstance(`instance of ${e.name}`):e.clone(`Clone of ${e.name}`,null,!0);if(!s)throw new Error(`Could not clone or instantiate node on Asset Container ${e.name}`);u(e,s)}for(const t of this.skeletons){if(c.predicate&&!c.predicate(t))continue;const s=t.clone(e?e(t.name):"Clone of "+t.name);for(const e of this.meshes)if(e.skeleton===t&&!e.isAnInstance){const t=i[n[e.uniqueId]];if(!t||t.isAnInstance)continue;if(t.skeleton=s,-1!==a.indexOf(s))continue;a.push(s);for(const e of s.bones)e._linkedTransformNode&&(e._linkedTransformNode=i[n[e._linkedTransformNode.uniqueId]])}r.skeletons.push(s)}for(const t of this.animationGroups){if(c.predicate&&!c.predicate(t))continue;const s=t.clone(e?e(t.name):"Clone of "+t.name,(e=>i[n[e.uniqueId]]||e));r.animationGroups.push(s)}return r}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||f.S0.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.scene.environmentTexture=this.environmentTexture);for(const e of this.scene._serializableComponents)e.addFromContainer(this);this.scene.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(e=null){const t=[];for(const s of this.cameras)e&&!e(s)||(this.scene.addCamera(s),t.push(s));for(const s of this.lights)e&&!e(s)||(this.scene.addLight(s),t.push(s));for(const s of this.meshes)e&&!e(s)||(this.scene.addMesh(s),t.push(s));for(const t of this.skeletons)e&&!e(t)||this.scene.addSkeleton(t);for(const t of this.animations)e&&!e(t)||this.scene.addAnimation(t);for(const t of this.animationGroups)e&&!e(t)||this.scene.addAnimationGroup(t);for(const t of this.multiMaterials)e&&!e(t)||this.scene.addMultiMaterial(t);for(const t of this.materials)e&&!e(t)||this.scene.addMaterial(t);for(const t of this.morphTargetManagers)e&&!e(t)||this.scene.addMorphTargetManager(t);for(const t of this.geometries)e&&!e(t)||this.scene.addGeometry(t);for(const s of this.transformNodes)e&&!e(s)||(this.scene.addTransformNode(s),t.push(s));for(const t of this.actionManagers)e&&!e(t)||this.scene.addActionManager(t);for(const t of this.textures)e&&!e(t)||this.scene.addTexture(t);for(const t of this.reflectionProbes)e&&!e(t)||this.scene.addReflectionProbe(t);if(t.length){const e=new Set(this.scene.meshes);for(const t of this.scene.lights)e.add(t);for(const t of this.scene.cameras)e.add(t);for(const t of this.scene.transformNodes)e.add(t);for(const t of this.skeletons)for(const s of t.bones)e.add(s);for(const s of t)s.parent&&!e.has(s.parent)&&(s.setParent?s.setParent(null):s.parent=null)}}removeAllFromScene(){this._isValidHierarchy()||f.S0.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.scene.environmentTexture&&(this.scene.environmentTexture=null);for(const e of this.scene._serializableComponents)e.removeFromContainer(this)}removeFromScene(e=null){for(const t of this.cameras)e&&!e(t)||this.scene.removeCamera(t);for(const t of this.lights)e&&!e(t)||this.scene.removeLight(t);for(const t of this.meshes)e&&!e(t)||this.scene.removeMesh(t,!0);for(const t of this.skeletons)e&&!e(t)||this.scene.removeSkeleton(t);for(const t of this.animations)e&&!e(t)||this.scene.removeAnimation(t);for(const t of this.animationGroups)e&&!e(t)||this.scene.removeAnimationGroup(t);for(const t of this.multiMaterials)e&&!e(t)||this.scene.removeMultiMaterial(t);for(const t of this.materials)e&&!e(t)||this.scene.removeMaterial(t);for(const t of this.morphTargetManagers)e&&!e(t)||this.scene.removeMorphTargetManager(t);for(const t of this.geometries)e&&!e(t)||this.scene.removeGeometry(t);for(const t of this.transformNodes)e&&!e(t)||this.scene.removeTransformNode(t);for(const t of this.actionManagers)e&&!e(t)||this.scene.removeActionManager(t);for(const t of this.textures)e&&!e(t)||this.scene.removeTexture(t);for(const t of this.reflectionProbes)e&&!e(t)||this.scene.removeReflectionProbe(t)}dispose(){const e=this.cameras.slice(0);for(const t of e)t.dispose();this.cameras.length=0;const t=this.lights.slice(0);for(const e of t)e.dispose();this.lights.length=0;const s=this.meshes.slice(0);for(const e of s)e.dispose();this.meshes.length=0;const o=this.skeletons.slice(0);for(const e of o)e.dispose();this.skeletons.length=0;const n=this.animationGroups.slice(0);for(const e of n)e.dispose();this.animationGroups.length=0;const i=this.multiMaterials.slice(0);for(const e of i)e.dispose();this.multiMaterials.length=0;const r=this.materials.slice(0);for(const e of r)e.dispose();this.materials.length=0;const a=this.geometries.slice(0);for(const e of a)e.dispose();this.geometries.length=0;const h=this.transformNodes.slice(0);for(const e of h)e.dispose();this.transformNodes.length=0;const c=this.actionManagers.slice(0);for(const e of c)e.dispose();this.actionManagers.length=0;const d=this.textures.slice(0);for(const e of d)e.dispose();this.textures.length=0;const f=this.reflectionProbes.slice(0);for(const e of f)e.dispose();this.reflectionProbes.length=0;const l=this.morphTargetManagers.slice(0);for(const e of l)e.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const e of this.scene._serializableComponents)e.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.scene.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(e,t,s){if(e&&t)for(const o of e){let e=!0;if(s)for(const t of s)if(o===t){e=!1;break}e&&(t.push(o),o._parentContainer=this)}}moveAllFromScene(e){this._wasAddedToScene=!1,void 0===e&&(e=new u);for(const t in this)Object.prototype.hasOwnProperty.call(this,t)&&(this[t]=this[t]||("_environmentTexture"===t?null:[]),this._moveAssets(this.scene[t],this[t],e[t]));this.environmentTexture=this.scene.environmentTexture,this.removeAllFromScene()}createRootMesh(){const e=new o.e("assetContainerRootMesh",this.scene);for(const t of this.meshes)t.parent||e.addChild(t);return this.meshes.unshift(e),e}mergeAnimationsTo(e=a.q.LastCreatedScene,t,s=null){if(!e)return r.V.Error("No scene available to merge animations to"),[];const o=s||(t=>{let s=null;const o=t.animations.length?t.animations[0].targetProperty:"",n=t.name.split(".").join("").split("_primitive")[0];switch(o){case"position":case"rotationQuaternion":s=e.getTransformNodeByName(t.name)||e.getTransformNodeByName(n);break;case"influence":s=e.getMorphTargetByName(t.name)||e.getMorphTargetByName(n);break;default:s=e.getNodeByName(t.name)||e.getNodeByName(n)}return s}),n=this.getNodes();for(const e of n){const t=o(e);if(null!==t){for(const s of e.animations){const e=t.animations.filter((e=>e.targetProperty===s.targetProperty));for(const s of e){const e=t.animations.indexOf(s,0);e>-1&&t.animations.splice(e,1)}}t.animations=t.animations.concat(e.animations)}}const i=[],h=this.animationGroups.slice();for(const e of h){i.push(e.clone(e.name,o));for(const t of e.animatables)t.stop()}for(const s of t){const t=o(s.target);t&&(e.beginAnimation(t,s.fromFrame,s.toFrame,s.loopAnimation,s.speedRatio,s.onAnimationEnd?s.onAnimationEnd:void 0,void 0,!0,void 0,s.onAnimationLoop?s.onAnimationLoop:void 0),e.stopAnimation(s.target))}return i}populateRootNodes(){this.rootNodes.length=0;for(const e of this.meshes)e.parent||-1!==this.rootNodes.indexOf(e)||this.rootNodes.push(e);for(const e of this.transformNodes)e.parent||-1!==this.rootNodes.indexOf(e)||this.rootNodes.push(e);for(const e of this.lights)e.parent||-1!==this.rootNodes.indexOf(e)||this.rootNodes.push(e);for(const e of this.cameras)e.parent||-1!==this.rootNodes.indexOf(e)||this.rootNodes.push(e)}addAllAssetsToContainer(e){if(!e)return;const t=[],s=new Set;for(t.push(e);t.length>0;){const e=t.pop();if(e instanceof o.e?(e.geometry&&-1===this.geometries.indexOf(e.geometry)&&this.geometries.push(e.geometry),this.meshes.push(e)):e instanceof h.Z?this.meshes.push(e):e instanceof n.V?this.transformNodes.push(e):e instanceof c.v?this.lights.push(e):e instanceof d.i&&this.cameras.push(e),e instanceof i.u){if(e.material&&-1===this.materials.indexOf(e.material)){this.materials.push(e.material);for(const t of e.material.getActiveTextures())-1===this.textures.indexOf(t)&&this.textures.push(t)}e.skeleton&&-1===this.skeletons.indexOf(e.skeleton)&&this.skeletons.push(e.skeleton),e.morphTargetManager&&-1===this.morphTargetManagers.indexOf(e.morphTargetManager)&&this.morphTargetManagers.push(e.morphTargetManager)}for(const o of e.getChildren())s.has(o)||t.push(o);s.add(e)}this.populateRootNodes()}_getByTags(e,t,s){if(void 0===t)return e;const o=[];for(const n in e){const i=e[n];l.Y&&l.Y.MatchesQuery(i,t)&&(!s||s(i))&&o.push(i)}return o}getMeshesByTags(e,t){return this._getByTags(this.meshes,e,t)}getCamerasByTags(e,t){return this._getByTags(this.cameras,e,t)}getLightsByTags(e,t){return this._getByTags(this.lights,e,t)}getMaterialsByTags(e,t){return this._getByTags(this.materials,e,t).concat(this._getByTags(this.multiMaterials,e,t))}getTransformNodesByTags(e,t){return this._getByTags(this.transformNodes,e,t)}}}}]);
//# sourceMappingURL=1067.bundle.js.map