{"version":3,"file":"8826.bundle.js","mappings":"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","sources":["webpack://@dev/inspector-v2/../core/src/AudioV2/abstractAudio/abstractSoundSource.ts?","webpack://@dev/inspector-v2/../core/src/AudioV2/webAudio/webAudioSoundSource.ts?"],"sourcesContent":["import type { Nullable } from \"../../types\";\nimport { AudioNodeType } from \"./abstractAudioNode\";\nimport type { IAbstractAudioOutNodeOptions } from \"./abstractAudioOutNode\";\nimport { AbstractAudioOutNode } from \"./abstractAudioOutNode\";\nimport type { PrimaryAudioBus } from \"./audioBus\";\nimport type { AudioEngineV2 } from \"./audioEngineV2\";\nimport type { AbstractSpatialAudio, ISpatialAudioOptions } from \"./subProperties/abstractSpatialAudio\";\nimport type { AbstractStereoAudio, IStereoAudioOptions } from \"./subProperties/abstractStereoAudio\";\n\n/**\n * Options for creating a sound source.\n */\nexport interface ISoundSourceOptions extends IAbstractAudioOutNodeOptions, ISpatialAudioOptions, IStereoAudioOptions {\n    /**\n     * The output bus for the sound source. Defaults to `null`.\n     * - If not set or `null`, and `outBusAutoDefault` is `true`, then the sound source is automatically connected to the audio engine's default main bus.\n     * @see {@link AudioEngineV2.defaultMainBus}\n     */\n    outBus: Nullable<PrimaryAudioBus>;\n\n    /**\n     * Whether the sound's `outBus` should default to the audio engine's main bus. Defaults to `true` for all sound sources except microphones.\n     */\n    outBusAutoDefault: boolean;\n}\n\n/**\n * Abstract class representing a sound in the audio engine.\n */\nexport abstract class AbstractSoundSource extends AbstractAudioOutNode {\n    private readonly _spatialAutoUpdate: boolean = true;\n    private readonly _spatialMinUpdateTime: number = 0;\n    private _outBus: Nullable<PrimaryAudioBus> = null;\n    private _spatial: Nullable<AbstractSpatialAudio> = null;\n\n    protected constructor(name: string, engine: AudioEngineV2, options: Partial<ISoundSourceOptions>, nodeType: AudioNodeType = AudioNodeType.HAS_OUTPUTS) {\n        super(name, engine, nodeType);\n\n        if (typeof options.spatialAutoUpdate === \"boolean\") {\n            this._spatialAutoUpdate = options.spatialAutoUpdate;\n        }\n\n        if (typeof options.spatialMinUpdateTime === \"number\") {\n            this._spatialMinUpdateTime = options.spatialMinUpdateTime;\n        }\n    }\n\n    /**\n     * The output bus for the sound.\n     * @see {@link AudioEngineV2.defaultMainBus}\n     */\n    public get outBus(): Nullable<PrimaryAudioBus> {\n        return this._outBus;\n    }\n\n    public set outBus(outBus: Nullable<PrimaryAudioBus>) {\n        if (this._outBus === outBus) {\n            return;\n        }\n\n        if (this._outBus) {\n            if (this._onOutBusDisposed) {\n                this._outBus.onDisposeObservable.removeCallback(this._onOutBusDisposed);\n                this._onOutBusDisposed = null;\n            }\n            if (!this._disconnect(this._outBus)) {\n                throw new Error(\"Disconnect failed\");\n            }\n        }\n\n        this._outBus = outBus;\n\n        if (this._outBus) {\n            this._onOutBusDisposed = () => {\n                this._outBus = null;\n            };\n            this._outBus.onDisposeObservable.add(this._onOutBusDisposed);\n            if (!this._connect(this._outBus)) {\n                throw new Error(\"Connect failed\");\n            }\n        }\n    }\n\n    /**\n     * The spatial audio features.\n     */\n    public get spatial(): AbstractSpatialAudio {\n        if (this._spatial) {\n            return this._spatial;\n        }\n        return this._initSpatialProperty();\n    }\n\n    /**\n     * The stereo features of the sound.\n     */\n    public abstract stereo: AbstractStereoAudio;\n\n    /**\n     * Releases associated resources.\n     */\n    public override dispose(): void {\n        super.dispose();\n\n        this._spatial?.dispose();\n        this._spatial = null;\n\n        if (this._outBus && this._onOutBusDisposed) {\n            this._outBus.onDisposeObservable.removeCallback(this._onOutBusDisposed);\n            this._onOutBusDisposed = null;\n        }\n        this._outBus = null;\n    }\n\n    protected abstract _createSpatialProperty(autoUpdate: boolean, minUpdateTime: number): AbstractSpatialAudio;\n\n    protected _initSpatialProperty(): AbstractSpatialAudio {\n        return (this._spatial = this._createSpatialProperty(this._spatialAutoUpdate, this._spatialMinUpdateTime));\n    }\n\n    private _onOutBusDisposed: Nullable<() => void> = null;\n\n    /** @internal */\n    public get _isSpatial(): boolean {\n        return this._spatial !== null;\n    }\n\n    public set _isSpatial(value: boolean) {\n        if (value && !this._spatial) {\n            this._initSpatialProperty();\n        } else if (!value && this._spatial) {\n            this._spatial.dispose();\n            this._spatial = null;\n        }\n    }\n}\n","import type { Nullable } from \"../../types\";\nimport type { AbstractAudioNode } from \"../abstractAudio/abstractAudioNode\";\nimport type { ISoundSourceOptions } from \"../abstractAudio/abstractSoundSource\";\nimport { AbstractSoundSource } from \"../abstractAudio/abstractSoundSource\";\nimport type { AbstractSpatialAudio } from \"../abstractAudio/subProperties/abstractSpatialAudio\";\nimport { _HasSpatialAudioOptions } from \"../abstractAudio/subProperties/abstractSpatialAudio\";\nimport { _StereoAudio } from \"../abstractAudio/subProperties/stereoAudio\";\nimport { _WebAudioBusAndSoundSubGraph } from \"./subNodes/webAudioBusAndSoundSubGraph\";\nimport { _SpatialWebAudio } from \"./subProperties/spatialWebAudio\";\nimport type { _WebAudioEngine } from \"./webAudioEngine\";\nimport type { IWebAudioInNode } from \"./webAudioNode\";\n\n/** @internal */\nexport class _WebAudioSoundSource extends AbstractSoundSource {\n    private _stereo: Nullable<_StereoAudio> = null;\n\n    protected _subGraph: _WebAudioBusAndSoundSubGraph;\n    protected _webAudioNode: AudioNode;\n\n    /** @internal */\n    public _audioContext: AudioContext | OfflineAudioContext;\n\n    /** @internal */\n    public override readonly engine: _WebAudioEngine;\n\n    /** @internal */\n    public constructor(name: string, webAudioNode: AudioNode, engine: _WebAudioEngine, options: Partial<ISoundSourceOptions>) {\n        super(name, engine, options);\n\n        this._audioContext = this.engine._audioContext;\n        this._webAudioNode = webAudioNode;\n\n        this._subGraph = new _WebAudioSoundSource._SubGraph(this);\n    }\n\n    /** @internal */\n    public async _initAsync(options: Partial<ISoundSourceOptions>): Promise<void> {\n        if (options.outBus) {\n            this.outBus = options.outBus;\n        } else if (options.outBusAutoDefault !== false) {\n            await this.engine.isReadyPromise;\n            this.outBus = this.engine.defaultMainBus;\n        }\n\n        await this._subGraph.initAsync(options);\n\n        if (_HasSpatialAudioOptions(options)) {\n            this._initSpatialProperty();\n        }\n\n        this.engine._addNode(this);\n    }\n\n    /** @internal */\n    public get _inNode() {\n        return this._webAudioNode;\n    }\n\n    /** @internal */\n    public get _outNode() {\n        return this._subGraph._outNode;\n    }\n\n    /** @internal */\n    public override get stereo(): _StereoAudio {\n        return this._stereo ?? (this._stereo = new _StereoAudio(this._subGraph));\n    }\n\n    /** @internal */\n    public override dispose(): void {\n        super.dispose();\n\n        this._stereo = null;\n\n        this._subGraph.dispose();\n\n        this.engine._removeNode(this);\n    }\n\n    /** @internal */\n    public getClassName(): string {\n        return \"_WebAudioSoundSource\";\n    }\n\n    protected override _connect(node: IWebAudioInNode): boolean {\n        const connected = super._connect(node);\n\n        if (!connected) {\n            return false;\n        }\n\n        // If the wrapped node is not available now, it will be connected later by the subgraph.\n        if (node._inNode) {\n            this._outNode?.connect(node._inNode);\n        }\n\n        return true;\n    }\n\n    protected override _disconnect(node: IWebAudioInNode): boolean {\n        const disconnected = super._disconnect(node);\n\n        if (!disconnected) {\n            return false;\n        }\n\n        if (node._inNode) {\n            this._outNode?.disconnect(node._inNode);\n        }\n\n        return true;\n    }\n\n    protected override _createSpatialProperty(autoUpdate: boolean, minUpdateTime: number): AbstractSpatialAudio {\n        return new _SpatialWebAudio(this._subGraph, autoUpdate, minUpdateTime);\n    }\n\n    private static _SubGraph = class extends _WebAudioBusAndSoundSubGraph {\n        protected override _owner: _WebAudioSoundSource;\n\n        protected get _downstreamNodes(): Nullable<Set<AbstractAudioNode>> {\n            return this._owner._downstreamNodes ?? null;\n        }\n\n        protected get _upstreamNodes(): Nullable<Set<AbstractAudioNode>> {\n            return this._owner._upstreamNodes ?? null;\n        }\n\n        protected override _onSubNodesChanged(): void {\n            super._onSubNodesChanged();\n\n            this._owner._inNode.disconnect();\n\n            if (this._owner._subGraph._inNode) {\n                this._owner._inNode.connect(this._owner._subGraph._inNode);\n            }\n        }\n    };\n}\n"],"names":["AbstractSoundSource","name","engine","options","nodeType","super","_spatialAutoUpdate","_spatialMinUpdateTime","_outBus","_spatial","_onOutBusDisposed","spatialAutoUpdate","this","spatialMinUpdateTime","outBus","onDisposeObservable","removeCallback","_disconnect","Error","add","_connect","spatial","_initSpatialProperty","dispose","_createSpatialProperty","_isSpatial","value","_WebAudioSoundSource","webAudioNode","_stereo","_audioContext","_webAudioNode","_subGraph","_SubGraph","_initAsync","outBusAutoDefault","isReadyPromise","defaultMainBus","initAsync","_addNode","_inNode","_outNode","stereo","_removeNode","getClassName","node","connect","disconnect","autoUpdate","minUpdateTime","_downstreamNodes","_owner","_upstreamNodes","_onSubNodesChanged"],"ignoreList":[],"sourceRoot":""}