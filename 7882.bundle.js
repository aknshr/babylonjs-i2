"use strict";(self.webpackChunk_dev_inspector_v2=self.webpackChunk_dev_inspector_v2||[]).push([[7882],{17882:(e,t,n)=>{n.d(t,{EXT_lights_image_based:()=>h});var s=n(15439),a=n(31273),i=n(64868),l=n(69884),o=n(96734);const r="EXT_lights_image_based";class h{constructor(e){this.name=r,this._loader=e,this.enabled=this._loader.isExtensionUsed(r)}dispose(){this._loader=null,delete this._lights}onLoading(){const e=this._loader.gltf.extensions;if(e&&e[this.name]){const t=e[this.name];this._lights=t.lights}}loadSceneAsync(e,t){return l.BT.LoadExtensionAsync(e,t,this.name,(async(n,s)=>{this._loader._allMaterialsDirtyRequired=!0;const a=new Array;a.push(this._loader.loadSceneAsync(e,t)),this._loader.logOpen(`${n}`);const i=l.l2.Get(`${n}/light`,this._lights,s.light);return a.push(this._loadLightAsync(`/extensions/${this.name}/lights/${s.light}`,i).then((e=>{this._loader.babylonScene.environmentTexture=e}))),this._loader.logClose(),await Promise.all(a).then((()=>{}))}))}_loadLightAsync(e,t){if(!t._loaded){const n=new Array;this._loader.logOpen(`${e}`);const o=new Array(t.specularImages.length);for(let s=0;s<t.specularImages.length;s++){const a=t.specularImages[s];o[s]=new Array(a.length);for(let t=0;t<a.length;t++){const i=`${e}/specularImages/${s}/${t}`;this._loader.logOpen(`${i}`);const r=a[t],h=l.l2.Get(i,this._loader.gltf.images,r);n.push(this._loader.loadImageAsync(`/images/${r}`,h).then((e=>{o[s][t]=e}))),this._loader.logClose()}}this._loader.logClose(),t._loaded=Promise.all(n).then((async()=>{const n=new i.p(this._loader.babylonScene,null,t.specularImageSize);if(n.name=t.name||"environment",t._babylonTexture=n,null!=t.intensity&&(n.level=t.intensity),t.rotation){let e=a.PT.FromArray(t.rotation);this._loader.babylonScene.useRightHandedSystem||(e=a.PT.Inverse(e)),a.uq.FromQuaternionToRef(e,n.getReflectionTextureMatrix())}if(!t.irradianceCoefficients)throw new Error(`${e}: Irradiance coefficients are missing`);const l=s.O.FromArray(t.irradianceCoefficients);l.scaleInPlace(t.intensity),l.convertIrradianceToLambertianRadiance();const r=s.Q.FromHarmonics(l),h=(o.length-1)/Math.log2(t.specularImageSize);return await n.updateRGBDAsync(o,r,h)}))}return t._loaded.then((()=>t._babylonTexture))}}(0,o.Hg)(r),(0,o.Ye)(r,!0,(e=>new h(e)))}}]);
//# sourceMappingURL=7882.bundle.js.map